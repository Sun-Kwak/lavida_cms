{
    "sourceFile": "src/utils/db/DailyScheduleService.ts",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1763871650891,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1763871650891,
            "name": "Commit-0",
            "content": "import { BaseDBManager } from './BaseDBManager';\nimport type { DailyScheduleSettings } from './types';\n\n/**\n * 일별 스케줄 설정 서비스 클래스\n * 직원의 날짜별 근무시간/휴일 정보를 관리\n */\nexport class DailyScheduleService extends BaseDBManager {\n  /**\n   * 일별 스케줄설정 저장/업데이트 (배열 일괄 처리)\n   */\n  async saveDailySchedules(\n    settingsArray: Omit<DailyScheduleSettings, 'id' | 'createdAt' | 'updatedAt'>[]\n  ): Promise<DailyScheduleSettings[]> {\n    try {\n      const savedSettings: DailyScheduleSettings[] = [];\n\n      for (const setting of settingsArray) {\n        // 기존 설정이 있는지 확인 (staffId + date 조합)\n        const existing = await this.getDailyScheduleByStaffAndDate(\n          setting.staffId,\n          setting.date\n        );\n\n        let savedSetting: DailyScheduleSettings;\n\n        if (existing) {\n          // 업데이트\n          savedSetting = {\n            ...existing,\n            ...setting,\n            updatedAt: new Date(),\n          };\n\n          await this.executeTransaction('dailyScheduleSettings', 'readwrite', (store) =>\n            store.put(savedSetting)\n          );\n        } else {\n          // 새로 추가\n          savedSetting = {\n            ...setting,\n            id: this.generateUUID(),\n            createdAt: new Date(),\n            updatedAt: new Date(),\n          };\n\n          await this.executeTransaction('dailyScheduleSettings', 'readwrite', (store) =>\n            store.add(savedSetting)\n          );\n        }\n\n        savedSettings.push(savedSetting);\n      }\n\n      console.log('일별 스케줄설정 저장 성공:', savedSettings.length);\n      return savedSettings;\n    } catch (error) {\n      console.error('일별 스케줄설정 저장 실패:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 특정 직원의 특정 날짜 스케줄 조회\n   */\n  async getDailyScheduleByStaffAndDate(\n    staffId: string,\n    date: string\n  ): Promise<DailyScheduleSettings | null> {\n    try {\n      const settings = await this.executeTransaction(\n        'dailyScheduleSettings',\n        'readonly',\n        (store) => {\n          const index = store.index('staffDate');\n          return index.getAll(IDBKeyRange.only([staffId, date]));\n        }\n      );\n\n      if (settings.length === 0) return null;\n\n      return {\n        ...settings[0],\n        createdAt: new Date(settings[0].createdAt),\n        updatedAt: new Date(settings[0].updatedAt),\n      };\n    } catch (error) {\n      console.error('일별 스케줄 조회 실패:', error);\n      return null;\n    }\n  }\n\n  /**\n   * 특정 직원의 날짜 범위 스케줄 조회\n   */\n  async getDailySchedulesByStaffAndDateRange(\n    staffId: string,\n    startDate: string,\n    endDate: string\n  ): Promise<DailyScheduleSettings[]> {\n    try {\n      const allSettings = await this.getDailySchedulesByStaff(staffId);\n\n      // 날짜 범위 필터링\n      return allSettings.filter(\n        (setting) => setting.date >= startDate && setting.date <= endDate\n      );\n    } catch (error) {\n      console.error('날짜 범위 스케줄 조회 실패:', error);\n      return [];\n    }\n  }\n\n  /**\n   * 특정 직원의 모든 일별 스케줄 조회\n   */\n  async getDailySchedulesByStaff(staffId: string): Promise<DailyScheduleSettings[]> {\n    try {\n      const settings = await this.executeTransaction(\n        'dailyScheduleSettings',\n        'readonly',\n        (store) => {\n          const index = store.index('staffId');\n          return index.getAll(IDBKeyRange.only(staffId));\n        }\n      );\n\n      return settings.map((setting) => ({\n        ...setting,\n        createdAt: new Date(setting.createdAt),\n        updatedAt: new Date(setting.updatedAt),\n      }));\n    } catch (error) {\n      console.error('직원별 일별 스케줄 조회 실패:', error);\n      return [];\n    }\n  }\n\n  /**\n   * 특정 날짜의 모든 스케줄 조회\n   */\n  async getDailySchedulesByDate(date: string): Promise<DailyScheduleSettings[]> {\n    try {\n      const settings = await this.executeTransaction(\n        'dailyScheduleSettings',\n        'readonly',\n        (store) => {\n          const index = store.index('date');\n          return index.getAll(IDBKeyRange.only(date));\n        }\n      );\n\n      return settings.map((setting) => ({\n        ...setting,\n        createdAt: new Date(setting.createdAt),\n        updatedAt: new Date(setting.updatedAt),\n      }));\n    } catch (error) {\n      console.error('날짜별 스케줄 조회 실패:', error);\n      return [];\n    }\n  }\n\n  /**\n   * 일별 스케줄 삭제\n   */\n  async deleteDailySchedule(id: string): Promise<boolean> {\n    try {\n      await this.executeTransaction('dailyScheduleSettings', 'readwrite', (store) =>\n        store.delete(id)\n      );\n\n      console.log('일별 스케줄 삭제 성공:', id);\n      return true;\n    } catch (error) {\n      console.error('일별 스케줄 삭제 실패:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 특정 직원의 모든 일별 스케줄 삭제\n   */\n  async deleteAllDailySchedulesByStaff(staffId: string): Promise<boolean> {\n    try {\n      const settings = await this.getDailySchedulesByStaff(staffId);\n\n      for (const setting of settings) {\n        await this.deleteDailySchedule(setting.id);\n      }\n\n      console.log('직원 일별 스케줄 전체 삭제 성공:', staffId);\n      return true;\n    } catch (error) {\n      console.error('직원 일별 스케줄 전체 삭제 실패:', error);\n      throw error;\n    }\n  }\n\n  /**\n   * 특정 날짜 범위의 스케줄 삭제\n   */\n  async deleteDailySchedulesByDateRange(\n    staffId: string,\n    startDate: string,\n    endDate: string\n  ): Promise<boolean> {\n    try {\n      const settings = await this.getDailySchedulesByStaffAndDateRange(\n        staffId,\n        startDate,\n        endDate\n      );\n\n      for (const setting of settings) {\n        await this.deleteDailySchedule(setting.id);\n      }\n\n      console.log('날짜 범위 스케줄 삭제 성공:', staffId, startDate, endDate);\n      return true;\n    } catch (error) {\n      console.error('날짜 범위 스케줄 삭제 실패:', error);\n      throw error;\n    }\n  }\n}\n"
        }
    ]
}