{
    "sourceFile": "src/components/ExercisePrescriptionForm.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 0,
            "patches": [
                {
                    "date": 1762429025913,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                }
            ],
            "date": 1762429025913,
            "name": "Commit-0",
            "content": "import React from 'react';\nimport styled from 'styled-components';\nimport { AppColors } from '../styles/colors';\nimport { AppTextStyles } from '../styles/textStyles';\nimport { Member, ExercisePrescription, ExercisePrescriptionMedicalHistory, BodyImagePoint } from '../utils/db/types';\nimport BodyImageCanvas from './BodyImageCanvas';\nimport SignatureCanvas from './SignatureCanvas';\n\nconst PrescriptionContainer = styled.div`\n  max-width: 800px;\n  margin: 0 auto;\n  background: white;\n  padding: 40px;\n  box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);\n  min-height: calc(100vh - 40px);\n  \n  @media print {\n    box-shadow: none;\n    padding: 20px;\n    margin: 0;\n    max-width: none;\n    min-height: auto;\n  }\n`;\n\nconst PrescriptionTitle = styled.h1`\n  text-align: center;\n  font-size: 24px;\n  font-weight: bold;\n  margin-bottom: 30px;\n  color: ${AppColors.onBackground};\n`;\n\nconst FormRow = styled.div`\n  display: flex;\n  gap: 15px;\n  margin-bottom: 20px;\n  align-items: flex-start;\n`;\n\nconst FormGroup = styled.div`\n  flex: 1;\n`;\n\nconst FormLabel = styled.label`\n  display: block;\n  font-size: ${AppTextStyles.label1.fontSize};\n  font-weight: 600;\n  color: ${AppColors.onBackground};\n  margin-bottom: 8px;\n`;\n\nconst FormInput = styled.input<{ readOnly?: boolean }>`\n  width: 100%;\n  padding: 10px;\n  border: 1px solid ${AppColors.borderLight};\n  border-radius: 6px;\n  font-size: ${AppTextStyles.body2.fontSize};\n  box-sizing: border-box;\n  background: ${props => props.readOnly ? '#f5f5f5' : 'white'};\n  \n  &:focus {\n    outline: none;\n    border-color: ${props => props.readOnly ? AppColors.borderLight : AppColors.primary};\n  }\n`;\n\nconst FormTextarea = styled.textarea<{ readOnly?: boolean }>`\n  width: 100%;\n  padding: 10px;\n  border: 1px solid ${AppColors.borderLight};\n  border-radius: 6px;\n  font-size: ${AppTextStyles.body2.fontSize};\n  resize: vertical;\n  box-sizing: border-box;\n  background: ${props => props.readOnly ? '#f5f5f5' : 'white'};\n  \n  &:focus {\n    outline: none;\n    border-color: ${props => props.readOnly ? AppColors.borderLight : AppColors.primary};\n  }\n`;\n\nconst CheckboxGroup = styled.div`\n  display: flex;\n  flex-wrap: wrap;\n  gap: 10px;\n`;\n\nconst CheckboxItem = styled.label<{ disabled?: boolean }>`\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  cursor: ${props => props.disabled ? 'default' : 'pointer'};\n  font-size: ${AppTextStyles.body2.fontSize};\n  opacity: ${props => props.disabled ? 0.7 : 1};\n`;\n\nconst Checkbox = styled.input<{ disabled?: boolean }>`\n  margin: 0;\n  cursor: ${props => props.disabled ? 'default' : 'pointer'};\n`;\n\nconst ImageSection = styled.div`\n  display: flex;\n  gap: 10px;\n  margin-bottom: 20px;\n`;\n\nconst ConsentSection = styled.div`\n  margin-top: 20px;\n  padding: 20px;\n  border: 1px solid ${AppColors.borderLight};\n  border-radius: 8px;\n  background: #f9f9f9;\n`;\n\nconst ConsentText = styled.p`\n  font-size: ${AppTextStyles.body2.fontSize};\n  line-height: 1.6;\n  color: ${AppColors.onBackground};\n  margin-bottom: 20px;\n`;\n\nconst DateRow = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  margin-top: 20px;\n  padding: 15px;\n  background: #f8f9fa;\n  border-radius: 8px;\n  border: 1px solid ${AppColors.borderLight};\n`;\n\nconst DateItem = styled.div`\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  gap: 5px;\n`;\n\nconst DateLabel = styled.div`\n  font-size: ${AppTextStyles.body3.fontSize};\n  color: ${AppColors.onInput1};\n  font-weight: 600;\n`;\n\nconst DateValue = styled.div`\n  font-size: ${AppTextStyles.body2.fontSize};\n  color: ${AppColors.onBackground};\n`;\n\nconst SignatureNote = styled.div`\n  margin-top: 8px;\n  font-size: ${AppTextStyles.body3.fontSize};\n  color: ${AppColors.onInput1};\n  text-align: center;\n  font-style: italic;\n`;\n\ninterface ExercisePrescriptionFormProps {\n  selectedMember: Member | null;\n  prescription: ExercisePrescription | null;\n  formData: {\n    height: string;\n    weight: string;\n    footSize: string;\n    medications: string;\n    medicalHistory: ExercisePrescriptionMedicalHistory;\n    painHistory: string;\n    bodyImages: {\n      front: BodyImagePoint[];\n      spine: BodyImagePoint[];\n      back: BodyImagePoint[];\n    };\n    signatureData: string;\n  };\n  readOnly?: boolean;\n  onInputChange?: (field: string, value: string) => void;\n  onCheckboxChange?: (field: string, checked: boolean) => void;\n  onSignatureChange?: (dataUrl: string) => void;\n  onAddBodyImagePoint?: (imageType: 'front' | 'spine' | 'back', point: Omit<BodyImagePoint, 'id'>) => void;\n  onUpdateBodyImagePoint?: (imageType: 'front' | 'spine' | 'back', pointId: string, updates: Partial<Omit<BodyImagePoint, 'id'>>) => void;\n  onDeleteBodyImagePoint?: (imageType: 'front' | 'spine' | 'back', pointId: string) => void;\n}\n\nconst ExercisePrescriptionForm: React.FC<ExercisePrescriptionFormProps> = ({\n  selectedMember,\n  prescription,\n  formData,\n  readOnly = false,\n  onInputChange,\n  onCheckboxChange,\n  onSignatureChange,\n  onAddBodyImagePoint,\n  onUpdateBodyImagePoint,\n  onDeleteBodyImagePoint\n}) => {\n  const hasExistingSignature = (): boolean => {\n    return !!(prescription?.signedAt && prescription?.signatureData && prescription.signatureData.trim() !== '');\n  };\n\n  return (\n    <PrescriptionContainer>\n      <PrescriptionTitle>운동처방서</PrescriptionTitle>\n      \n      {/* 기본 정보 */}\n      <FormRow>\n        <FormGroup>\n          <FormLabel>성명</FormLabel>\n          <FormInput\n            type=\"text\"\n            value={selectedMember?.name || ''}\n            readOnly\n            style={{ background: '#f5f5f5' }}\n          />\n        </FormGroup>\n        <FormGroup>\n          <FormLabel>생년월일</FormLabel>\n          <FormInput\n            type=\"text\"\n            value={selectedMember?.birth || ''}\n            readOnly\n            style={{ background: '#f5f5f5' }}\n          />\n        </FormGroup>\n        <FormGroup>\n          <FormLabel>키</FormLabel>\n          <FormInput\n            type=\"text\"\n            placeholder=\"키(cm)\"\n            value={formData.height}\n            readOnly={readOnly}\n            onChange={!readOnly && onInputChange ? (e) => onInputChange('height', e.target.value) : undefined}\n          />\n        </FormGroup>\n        <FormGroup>\n          <FormLabel>체중</FormLabel>\n          <FormInput\n            type=\"text\"\n            placeholder=\"체중(kg)\"\n            value={formData.weight}\n            readOnly={readOnly}\n            onChange={!readOnly && onInputChange ? (e) => onInputChange('weight', e.target.value) : undefined}\n          />\n        </FormGroup>\n        <FormGroup>\n          <FormLabel>발사이즈</FormLabel>\n          <FormInput\n            type=\"text\"\n            placeholder=\"발사이즈\"\n            value={formData.footSize}\n            readOnly={readOnly}\n            onChange={!readOnly && onInputChange ? (e) => onInputChange('footSize', e.target.value) : undefined}\n          />\n        </FormGroup>\n      </FormRow>\n\n      {/* 복용중인 약 - 라벨과 입력란을 같은 행에 배치 */}\n      <FormRow>\n        <FormGroup style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\n          <FormLabel style={{ marginBottom: '0', minWidth: '120px', flexShrink: 0 }}>복용중인 약</FormLabel>\n          <FormInput\n            type=\"text\"\n            placeholder=\"복용중인 약물을 입력하세요\"\n            value={formData.medications}\n            readOnly={readOnly}\n            onChange={!readOnly && onInputChange ? (e) => onInputChange('medications', e.target.value) : undefined}\n            style={{ flex: 1 }}\n          />\n        </FormGroup>\n      </FormRow>\n\n      {/* 병력사항 - 라벨과 체크박스를 같은 행에 배치 */}\n      <FormRow>\n        <FormGroup style={{ display: 'flex', alignItems: 'center', gap: '15px' }}>\n          <FormLabel style={{ marginBottom: '0', minWidth: '120px', flexShrink: 0 }}>병력사항</FormLabel>\n          <CheckboxGroup style={{ flex: 1 }}>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.musculoskeletal}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('musculoskeletal', e.target.checked) : undefined}\n              />\n              근골격계질환\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.cardiovascular}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('cardiovascular', e.target.checked) : undefined}\n              />\n              심혈관계질환\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.diabetes}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('diabetes', e.target.checked) : undefined}\n              />\n              당뇨\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.osteoporosis}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('osteoporosis', e.target.checked) : undefined}\n              />\n              골다공증\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.thyroid}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('thyroid', e.target.checked) : undefined}\n              />\n              갑상선\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.varicose}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('varicose', e.target.checked) : undefined}\n              />\n              정맥류\n            </CheckboxItem>\n            <CheckboxItem disabled={readOnly}>\n              <Checkbox\n                type=\"checkbox\"\n                checked={formData.medicalHistory.arthritis}\n                disabled={readOnly}\n                onChange={!readOnly && onCheckboxChange ? (e) => onCheckboxChange('arthritis', e.target.checked) : undefined}\n              />\n              관절염\n            </CheckboxItem>\n          </CheckboxGroup>\n        </FormGroup>\n      </FormRow>\n\n      {/* 이미지 영역 */}\n      <ImageSection>\n        <div data-image-type=\"front\">\n          <BodyImageCanvas\n            imageType=\"front\"\n            imageUrl=\"\"\n            points={formData.bodyImages.front}\n            readonly={readOnly}\n            onAddPoint={readOnly ? () => {} : onAddBodyImagePoint ? (point) => onAddBodyImagePoint('front', point) : () => {}}\n            onUpdatePoint={readOnly ? () => {} : onUpdateBodyImagePoint ? (pointId, updates) => onUpdateBodyImagePoint('front', pointId, updates) : () => {}}\n            onDeletePoint={readOnly ? () => {} : onDeleteBodyImagePoint ? (pointId) => onDeleteBodyImagePoint('front', pointId) : () => {}}\n          />\n        </div>\n        <div data-image-type=\"spine\">\n          <BodyImageCanvas\n            imageType=\"spine\"\n            imageUrl=\"\"\n            points={formData.bodyImages.spine}\n            readonly={readOnly}\n            onAddPoint={readOnly ? () => {} : onAddBodyImagePoint ? (point) => onAddBodyImagePoint('spine', point) : () => {}}\n            onUpdatePoint={readOnly ? () => {} : onUpdateBodyImagePoint ? (pointId, updates) => onUpdateBodyImagePoint('spine', pointId, updates) : () => {}}\n            onDeletePoint={readOnly ? () => {} : onDeleteBodyImagePoint ? (pointId) => onDeleteBodyImagePoint('spine', pointId) : () => {}}\n          />\n        </div>\n        <div data-image-type=\"back\">\n          <BodyImageCanvas\n            imageType=\"back\"\n            imageUrl=\"\"\n            points={formData.bodyImages.back}\n            readonly={readOnly}\n            onAddPoint={readOnly ? () => {} : onAddBodyImagePoint ? (point) => onAddBodyImagePoint('back', point) : () => {}}\n            onUpdatePoint={readOnly ? () => {} : onUpdateBodyImagePoint ? (pointId, updates) => onUpdateBodyImagePoint('back', pointId, updates) : () => {}}\n            onDeletePoint={readOnly ? () => {} : onDeleteBodyImagePoint ? (pointId) => onDeleteBodyImagePoint('back', pointId) : () => {}}\n          />\n        </div>\n      </ImageSection>\n\n      {/* 통증 히스토리 및 운동목적 */}\n      <FormRow>\n        <FormGroup>\n          <FormLabel>시술, 수술 등 통증 히스토리 및 코멘트/운동목적</FormLabel>\n          <FormTextarea\n            rows={6}\n            placeholder=\"통증 히스토리, 수술 이력, 운동 목적 등을 상세히 기입해주세요\"\n            value={formData.painHistory}\n            readOnly={readOnly}\n            onChange={!readOnly && onInputChange ? (e) => onInputChange('painHistory', e.target.value) : undefined}\n          />\n        </FormGroup>\n      </FormRow>\n\n      {/* 동의서 */}\n      <ConsentSection>\n        <ConsentText>\n          라비다 스포츠메디컬에서 제공하는 WBM 프로그램을 효과적으로 이용하기 위해 회원님 사전 건강 정보 작성에 동의하며, \n          본 상담지에 명시되지 않은 병력 및 기타 원인으로 발생되는 문제에 대해서는 당사는 일체의 책임이 없음을 알려 드립니다.\n        </ConsentText>\n        \n        {/* 서명 영역과 날짜 정보를 하나의 행으로 배치 */}\n        <div style={{ display: 'flex', gap: '20px', alignItems: 'flex-start' }}>\n          {/* 날짜 정보 카드 - 왼쪽 */}\n          <div style={{ flex: '0 0 auto', minWidth: '300px' }}>\n            {/* 서명 안내 텍스트 */}\n            <div style={{ marginBottom: '10px', textAlign: 'center' }}>\n              {hasExistingSignature() && (\n                <SignatureNote style={{ margin: '0', fontSize: '12px', color: '#28a745' }}>\n                  ✓ 서명이 완료되었습니다{readOnly ? '' : ' (수정 불가)'}\n                </SignatureNote>\n              )}\n              {!hasExistingSignature() && !readOnly && (\n                <SignatureNote style={{ margin: '0', fontSize: '12px' }}>\n                  서명 후 저장하시면 수정할 수 없습니다\n                </SignatureNote>\n              )}\n            </div>\n            {/* 날짜 카드 */}\n            <DateRow style={{ margin: '0' }}>\n              <DateItem>\n                <DateLabel>서명 날짜</DateLabel>\n                <DateValue>\n                  {prescription?.signedAt \n                    ? new Date(prescription.signedAt).toLocaleDateString('ko-KR')\n                    : readOnly\n                      ? '-'\n                      : '서명 후 표시됩니다'\n                  }\n                </DateValue>\n              </DateItem>\n              <DateItem>\n                <DateLabel>최근 업데이트</DateLabel>\n                <DateValue>\n                  {prescription?.updatedAt \n                    ? new Date(prescription.updatedAt).toLocaleDateString('ko-KR')\n                    : readOnly\n                      ? '-'\n                      : '저장 후 표시됩니다'\n                  }\n                </DateValue>\n              </DateItem>\n            </DateRow>\n          </div>\n\n          {/* 서명 영역 - 오른쪽 */}\n          <div style={{ flex: 1, display: 'flex', flexDirection: 'column', alignItems: 'center', justifyContent: 'center' }}>\n            <SignatureCanvas\n              key={selectedMember?.id || 'no-member'}\n              width={250}\n              height={100}\n              onSignatureChange={readOnly ? () => {} : onSignatureChange || (() => {})}\n              initialSignature={formData.signatureData}\n              readonly={readOnly || hasExistingSignature()}\n            />\n          </div>\n        </div>\n      </ConsentSection>\n    </PrescriptionContainer>\n  );\n};\n\nexport default ExercisePrescriptionForm;"
        }
    ]
}