{
    "sourceFile": "src/components/ReservationEditModal.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 12,
            "patches": [
                {
                    "date": 1763865368702,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763865574124,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -152,17 +152,8 @@\n     cursor: not-allowed;\n   }\n `;\n \n-const WarningText = styled.div`\n-  ${AppTextStyles.body3}\n-  color: #ef4444;\n-  padding: 8px 12px;\n-  background-color: #fef2f2;\n-  border-radius: 4px;\n-  border: 1px solid #fecaca;\n-`;\n-\n interface ReservationEditModalProps {\n   isOpen: boolean;\n   onClose: () => void;\n   event: ScheduleEvent;\n@@ -184,8 +175,9 @@\n   currentUser\n }) => {\n   const [memo, setMemo] = useState(event.reservationMemo || '');\n   const [loading, setLoading] = useState(false);\n+  const [memoSaving, setMemoSaving] = useState(false);\n \n   // 현재 시간보다 지났는지 확인\n   const isPast = new Date() > event.startTime;\n   // 편집 가능 여부 (지나지 않은 예약만 편집 가능)\n@@ -214,36 +206,35 @@\n         return '예약';\n     }\n   };\n \n-  const handleSave = async () => {\n-    if (!canEdit && memo === event.reservationMemo) {\n-      // 과거 예약이고 메모 변경이 없으면 그냥 닫기\n-      onClose();\n+  // 메모 개별 저장\n+  const handleMemoSave = async () => {\n+    if (memo === event.reservationMemo) {\n+      toast.info('변경된 내용이 없습니다.');\n       return;\n     }\n \n-    setLoading(true);\n+    setMemoSaving(true);\n     try {\n-      // 메모만 업데이트하거나 전체 이벤트 업데이트\n+      // DB 업데이트\n+      await dbManager.updateScheduleEvent(event.id, {\n+        reservationMemo: memo || undefined\n+      });\n+\n+      // 업데이트된 이벤트 생성\n       const updatedEvent: ScheduleEvent = {\n         ...event,\n         reservationMemo: memo || undefined\n       };\n \n-      // DB 업데이트\n-      await dbManager.updateScheduleEvent(event.id, {\n-        reservationMemo: memo || undefined\n-      });\n-\n-      toast.success('예약이 수정되었습니다.');\n+      toast.success('메모가 저장되었습니다.');\n       onUpdate(updatedEvent);\n-      onClose();\n     } catch (error) {\n-      console.error('예약 수정 실패:', error);\n-      toast.error('예약 수정에 실패했습니다.');\n+      console.error('메모 저장 실패:', error);\n+      toast.error('메모 저장에 실패했습니다.');\n     } finally {\n-      setLoading(false);\n+      setMemoSaving(false);\n     }\n   };\n \n   const handleDelete = async () => {\n@@ -277,14 +268,8 @@\n       header=\"예약 상세\"\n       width=\"600px\"\n       body={\n       <ModalContent>\n-        {isPast && (\n-          <WarningText>\n-            ⚠️ 지난 예약은 메모만 수정 가능합니다. 다른 정보는 수정할 수 없습니다.\n-          </WarningText>\n-        )}\n-\n         <Section>\n           <SectionTitle>예약 정보</SectionTitle>\n           \n           <InfoRow>\n@@ -332,10 +317,19 @@\n           <MemoTextArea\n             value={memo}\n             onChange={(e) => setMemo(e.target.value)}\n             placeholder=\"예약 관련 메모를 입력하세요...\"\n-            disabled={loading}\n+            disabled={memoSaving}\n           />\n+          <ButtonGroup style={{ marginTop: '12px', justifyContent: 'flex-end' }}>\n+            <Button\n+              $variant=\"primary\"\n+              onClick={handleMemoSave}\n+              disabled={memoSaving || memo === event.reservationMemo}\n+            >\n+              {memoSaving ? '저장 중...' : '메모 저장'}\n+            </Button>\n+          </ButtonGroup>\n         </Section>\n \n         <ButtonGroup>\n           {canEdit && (\n@@ -349,19 +343,12 @@\n           )}\n           <Button\n             $variant=\"secondary\"\n             onClick={onClose}\n-            disabled={loading}\n+            disabled={loading || memoSaving}\n           >\n-            취소\n+            닫기\n           </Button>\n-          <Button\n-            $variant=\"primary\"\n-            onClick={handleSave}\n-            disabled={loading}\n-          >\n-            {loading ? '저장 중...' : '저장'}\n-          </Button>\n         </ButtonGroup>\n       </ModalContent>\n       }\n     />\n"
                },
                {
                    "date": 1763865734146,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -178,9 +178,9 @@\n   const [loading, setLoading] = useState(false);\n   const [memoSaving, setMemoSaving] = useState(false);\n \n   // 현재 시간보다 지났는지 확인\n-  const isPast = new Date() > event.startTime;\n+  const isPast = new Date() > new Date(event.startTime);\n   // 편집 가능 여부 (지나지 않은 예약만 편집 가능)\n   const canEdit = !isPast;\n \n   useEffect(() => {\n"
                },
                {
                    "date": 1763865805751,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -178,9 +178,18 @@\n   const [loading, setLoading] = useState(false);\n   const [memoSaving, setMemoSaving] = useState(false);\n \n   // 현재 시간보다 지났는지 확인\n-  const isPast = new Date() > new Date(event.startTime);\n+  const now = new Date();\n+  const eventStartTime = new Date(event.startTime);\n+  const isPast = now >= eventStartTime;\n+  \n+  // 디버깅용 로그\n+  console.log('현재 시간:', now);\n+  console.log('예약 시작 시간:', eventStartTime);\n+  console.log('지난 예약인가?:', isPast);\n+  console.log('event.startTime 원본:', event.startTime);\n+  \n   // 편집 가능 여부 (지나지 않은 예약만 편집 가능)\n   const canEdit = !isPast;\n \n   useEffect(() => {\n"
                },
                {
                    "date": 1763865988040,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -49,8 +49,37 @@\n   color: ${AppColors.onBackground};\n   flex: 1;\n `;\n \n+const EditInput = styled.input`\n+  flex: 1;\n+  padding: 8px 12px;\n+  border: 1px solid ${AppColors.borderLight};\n+  border-radius: 4px;\n+  font-size: ${AppTextStyles.body1.fontSize};\n+  \n+  &:focus {\n+    outline: none;\n+    border-color: ${AppColors.primary};\n+    box-shadow: 0 0 0 2px ${AppColors.primary}20;\n+  }\n+`;\n+\n+const EditSelect = styled.select`\n+  flex: 1;\n+  padding: 8px 12px;\n+  border: 1px solid ${AppColors.borderLight};\n+  border-radius: 4px;\n+  font-size: ${AppTextStyles.body1.fontSize};\n+  background-color: white;\n+  \n+  &:focus {\n+    outline: none;\n+    border-color: ${AppColors.primary};\n+    box-shadow: 0 0 0 2px ${AppColors.primary}20;\n+  }\n+`;\n+\n const ReservationTypeTag = styled.span<{ $type: 'class' | 'consultation' | 'other' }>`\n   display: inline-block;\n   padding: 4px 12px;\n   border-radius: 4px;\n@@ -173,11 +202,19 @@\n   onUpdate,\n   onDelete,\n   currentUser\n }) => {\n+  const [isEditMode, setIsEditMode] = useState(false);\n   const [memo, setMemo] = useState(event.reservationMemo || '');\n   const [loading, setLoading] = useState(false);\n   const [memoSaving, setMemoSaving] = useState(false);\n+  \n+  // 수정 가능한 필드들\n+  const [editedType, setEditedType] = useState<'class' | 'consultation' | 'other'>(\n+    event.type as 'class' | 'consultation' | 'other'\n+  );\n+  const [editedStartTime, setEditedStartTime] = useState('');\n+  const [editedEndTime, setEditedEndTime] = useState('');\n \n   // 현재 시간보다 지났는지 확인\n   const now = new Date();\n   const eventStartTime = new Date(event.startTime);\n@@ -193,10 +230,27 @@\n   const canEdit = !isPast;\n \n   useEffect(() => {\n     setMemo(event.reservationMemo || '');\n+    setEditedType(event.type as 'class' | 'consultation' | 'other');\n+    \n+    // 시간을 datetime-local input에 맞는 형식으로 변환\n+    const startDate = new Date(event.startTime);\n+    const endDate = new Date(event.endTime);\n+    \n+    setEditedStartTime(formatDateTimeForInput(startDate));\n+    setEditedEndTime(formatDateTimeForInput(endDate));\n   }, [event]);\n \n+  const formatDateTimeForInput = (date: Date) => {\n+    const year = date.getFullYear();\n+    const month = String(date.getMonth() + 1).padStart(2, '0');\n+    const day = String(date.getDate()).padStart(2, '0');\n+    const hours = String(date.getHours()).padStart(2, '0');\n+    const minutes = String(date.getMinutes()).padStart(2, '0');\n+    return `${year}-${month}-${day}T${hours}:${minutes}`;\n+  };\n+\n   const formatDateTime = (date: Date) => {\n     const year = date.getFullYear();\n     const month = String(date.getMonth() + 1).padStart(2, '0');\n     const day = String(date.getDate()).padStart(2, '0');\n@@ -245,8 +299,76 @@\n       setMemoSaving(false);\n     }\n   };\n \n+  // 예약 정보 수정\n+  const handleSaveEdit = async () => {\n+    if (!isEditMode) {\n+      setIsEditMode(true);\n+      return;\n+    }\n+\n+    setLoading(true);\n+    try {\n+      const startTime = new Date(editedStartTime);\n+      const endTime = new Date(editedEndTime);\n+\n+      // 유효성 검사\n+      if (startTime >= endTime) {\n+        toast.error('종료 시간은 시작 시간보다 늦어야 합니다.');\n+        setLoading(false);\n+        return;\n+      }\n+\n+      // 제목 업데이트\n+      let newTitle = '';\n+      switch (editedType) {\n+        case 'consultation':\n+          newTitle = `[상담] ${event.memberName}`;\n+          break;\n+        case 'other':\n+          newTitle = `[기타] ${event.memberName}`;\n+          break;\n+        default:\n+          newTitle = `[예약] ${event.memberName}`;\n+          break;\n+      }\n+\n+      // DB 업데이트\n+      await dbManager.updateScheduleEvent(event.id, {\n+        type: editedType,\n+        startTime,\n+        endTime,\n+        title: newTitle\n+      });\n+\n+      // 업데이트된 이벤트 생성\n+      const updatedEvent: ScheduleEvent = {\n+        ...event,\n+        type: editedType,\n+        startTime,\n+        endTime,\n+        title: newTitle\n+      };\n+\n+      toast.success('예약이 수정되었습니다.');\n+      onUpdate(updatedEvent);\n+      setIsEditMode(false);\n+    } catch (error) {\n+      console.error('예약 수정 실패:', error);\n+      toast.error('예약 수정에 실패했습니다.');\n+    } finally {\n+      setLoading(false);\n+    }\n+  };\n+\n+  const handleCancelEdit = () => {\n+    setIsEditMode(false);\n+    setEditedType(event.type as 'class' | 'consultation' | 'other');\n+    setEditedStartTime(formatDateTimeForInput(new Date(event.startTime)));\n+    setEditedEndTime(formatDateTimeForInput(new Date(event.endTime)));\n+  };\n+\n   const handleDelete = async () => {\n     if (!canEdit) {\n       toast.error('지난 예약은 삭제할 수 없습니다.');\n       return;\n@@ -282,13 +404,24 @@\n           <SectionTitle>예약 정보</SectionTitle>\n           \n           <InfoRow>\n             <InfoLabel>예약 유형:</InfoLabel>\n-            <InfoValue>\n-              <ReservationTypeTag $type={event.type as 'class' | 'consultation' | 'other'}>\n-                {getReservationTypeText(event.type)}\n-              </ReservationTypeTag>\n-            </InfoValue>\n+            {isEditMode ? (\n+              <EditSelect\n+                value={editedType}\n+                onChange={(e) => setEditedType(e.target.value as 'class' | 'consultation' | 'other')}\n+              >\n+                <option value=\"class\">예약</option>\n+                <option value=\"consultation\">상담</option>\n+                <option value=\"other\">기타</option>\n+              </EditSelect>\n+            ) : (\n+              <InfoValue>\n+                <ReservationTypeTag $type={event.type as 'class' | 'consultation' | 'other'}>\n+                  {getReservationTypeText(event.type)}\n+                </ReservationTypeTag>\n+              </InfoValue>\n+            )}\n           </InfoRow>\n \n           <InfoRow>\n             <InfoLabel>회원명:</InfoLabel>\n@@ -311,14 +444,30 @@\n           </InfoRow>\n \n           <InfoRow>\n             <InfoLabel>시작 시간:</InfoLabel>\n-            <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n+            {isEditMode ? (\n+              <EditInput\n+                type=\"datetime-local\"\n+                value={editedStartTime}\n+                onChange={(e) => setEditedStartTime(e.target.value)}\n+              />\n+            ) : (\n+              <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n+            )}\n           </InfoRow>\n \n           <InfoRow>\n             <InfoLabel>종료 시간:</InfoLabel>\n-            <InfoValue>{formatDateTime(event.endTime)}</InfoValue>\n+            {isEditMode ? (\n+              <EditInput\n+                type=\"datetime-local\"\n+                value={editedEndTime}\n+                onChange={(e) => setEditedEndTime(e.target.value)}\n+              />\n+            ) : (\n+              <InfoValue>{formatDateTime(event.endTime)}</InfoValue>\n+            )}\n           </InfoRow>\n         </Section>\n \n         <Section>\n@@ -341,23 +490,55 @@\n         </Section>\n \n         <ButtonGroup>\n           {canEdit && (\n+            <>\n+              {isEditMode ? (\n+                <>\n+                  <Button\n+                    $variant=\"secondary\"\n+                    onClick={handleCancelEdit}\n+                    disabled={loading}\n+                  >\n+                    취소\n+                  </Button>\n+                  <Button\n+                    $variant=\"primary\"\n+                    onClick={handleSaveEdit}\n+                    disabled={loading}\n+                  >\n+                    {loading ? '저장 중...' : '저장'}\n+                  </Button>\n+                </>\n+              ) : (\n+                <>\n+                  <Button\n+                    $variant=\"danger\"\n+                    onClick={handleDelete}\n+                    disabled={loading}\n+                  >\n+                    삭제\n+                  </Button>\n+                  <Button\n+                    $variant=\"primary\"\n+                    onClick={handleSaveEdit}\n+                    disabled={loading}\n+                  >\n+                    수정\n+                  </Button>\n+                </>\n+              )}\n+            </>\n+          )}\n+          {!isEditMode && (\n             <Button\n-              $variant=\"danger\"\n-              onClick={handleDelete}\n-              disabled={loading}\n+              $variant=\"secondary\"\n+              onClick={onClose}\n+              disabled={loading || memoSaving}\n             >\n-              삭제\n+              닫기\n             </Button>\n           )}\n-          <Button\n-            $variant=\"secondary\"\n-            onClick={onClose}\n-            disabled={loading || memoSaving}\n-          >\n-            닫기\n-          </Button>\n         </ButtonGroup>\n       </ModalContent>\n       }\n     />\n"
                },
                {
                    "date": 1763866115360,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,14 +41,16 @@\n   ${AppTextStyles.body2}\n   font-weight: 600;\n   color: ${AppColors.onSurface};\n   min-width: 100px;\n+  text-align: left;\n `;\n \n const InfoValue = styled.div`\n   ${AppTextStyles.body1}\n   color: ${AppColors.onBackground};\n   flex: 1;\n+  text-align: left;\n `;\n \n const EditInput = styled.input`\n   flex: 1;\n"
                },
                {
                    "date": 1763866435140,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -213,46 +213,58 @@\n   // 수정 가능한 필드들\n   const [editedType, setEditedType] = useState<'class' | 'consultation' | 'other'>(\n     event.type as 'class' | 'consultation' | 'other'\n   );\n-  const [editedStartTime, setEditedStartTime] = useState('');\n-  const [editedEndTime, setEditedEndTime] = useState('');\n+  const [selectedDate, setSelectedDate] = useState('');\n+  const [selectedTime, setSelectedTime] = useState('');\n \n   // 현재 시간보다 지났는지 확인\n   const now = new Date();\n   const eventStartTime = new Date(event.startTime);\n   const isPast = now >= eventStartTime;\n   \n-  // 디버깅용 로그\n-  console.log('현재 시간:', now);\n-  console.log('예약 시작 시간:', eventStartTime);\n-  console.log('지난 예약인가?:', isPast);\n-  console.log('event.startTime 원본:', event.startTime);\n-  \n   // 편집 가능 여부 (지나지 않은 예약만 편집 가능)\n   const canEdit = !isPast;\n \n+  // 예약 유형에 따른 소요시간 계산 (분 단위)\n+  const getDuration = () => {\n+    if (editedType === 'consultation' || editedType === 'other') {\n+      return 30; // 상담/기타는 30분\n+    }\n+    // 일반 예약은 기존 소요시간 사용\n+    const duration = (new Date(event.endTime).getTime() - new Date(event.startTime).getTime()) / (1000 * 60);\n+    return duration;\n+  };\n+\n+  // 종료 시간 자동 계산\n+  const calculateEndTime = (startDateStr: string, startTimeStr: string) => {\n+    if (!startDateStr || !startTimeStr) return '';\n+    \n+    const [hours, minutes] = startTimeStr.split(':');\n+    const startDateTime = new Date(startDateStr);\n+    startDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n+    \n+    const duration = getDuration();\n+    const endDateTime = new Date(startDateTime.getTime() + duration * 60 * 1000);\n+    \n+    return endDateTime;\n+  };\n+\n   useEffect(() => {\n     setMemo(event.reservationMemo || '');\n     setEditedType(event.type as 'class' | 'consultation' | 'other');\n     \n-    // 시간을 datetime-local input에 맞는 형식으로 변환\n     const startDate = new Date(event.startTime);\n-    const endDate = new Date(event.endTime);\n+    const year = startDate.getFullYear();\n+    const month = String(startDate.getMonth() + 1).padStart(2, '0');\n+    const day = String(startDate.getDate()).padStart(2, '0');\n+    const hours = String(startDate.getHours()).padStart(2, '0');\n+    const minutes = String(startDate.getMinutes()).padStart(2, '0');\n     \n-    setEditedStartTime(formatDateTimeForInput(startDate));\n-    setEditedEndTime(formatDateTimeForInput(endDate));\n+    setSelectedDate(`${year}-${month}-${day}`);\n+    setSelectedTime(`${hours}:${minutes}`);\n   }, [event]);\n \n-  const formatDateTimeForInput = (date: Date) => {\n-    const year = date.getFullYear();\n-    const month = String(date.getMonth() + 1).padStart(2, '0');\n-    const day = String(date.getDate()).padStart(2, '0');\n-    const hours = String(date.getHours()).padStart(2, '0');\n-    const minutes = String(date.getMinutes()).padStart(2, '0');\n-    return `${year}-${month}-${day}T${hours}:${minutes}`;\n-  };\n-\n   const formatDateTime = (date: Date) => {\n     const year = date.getFullYear();\n     const month = String(date.getMonth() + 1).padStart(2, '0');\n     const day = String(date.getDate()).padStart(2, '0');\n@@ -310,14 +322,18 @@\n     }\n \n     setLoading(true);\n     try {\n-      const startTime = new Date(editedStartTime);\n-      const endTime = new Date(editedEndTime);\n+      // 시작 시간 생성\n+      const [hours, minutes] = selectedTime.split(':');\n+      const startTime = new Date(selectedDate);\n+      startTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n+      \n+      // 종료 시간 자동 계산\n+      const endTime = calculateEndTime(selectedDate, selectedTime);\n \n-      // 유효성 검사\n-      if (startTime >= endTime) {\n-        toast.error('종료 시간은 시작 시간보다 늦어야 합니다.');\n+      if (!endTime) {\n+        toast.error('시간 정보가 올바르지 않습니다.');\n         setLoading(false);\n         return;\n       }\n \n@@ -365,10 +381,18 @@\n \n   const handleCancelEdit = () => {\n     setIsEditMode(false);\n     setEditedType(event.type as 'class' | 'consultation' | 'other');\n-    setEditedStartTime(formatDateTimeForInput(new Date(event.startTime)));\n-    setEditedEndTime(formatDateTimeForInput(new Date(event.endTime)));\n+    \n+    const startDate = new Date(event.startTime);\n+    const year = startDate.getFullYear();\n+    const month = String(startDate.getMonth() + 1).padStart(2, '0');\n+    const day = String(startDate.getDate()).padStart(2, '0');\n+    const hours = String(startDate.getHours()).padStart(2, '0');\n+    const minutes = String(startDate.getMinutes()).padStart(2, '0');\n+    \n+    setSelectedDate(`${year}-${month}-${day}`);\n+    setSelectedTime(`${hours}:${minutes}`);\n   };\n \n   const handleDelete = async () => {\n     if (!canEdit) {\n@@ -447,29 +471,35 @@\n \n           <InfoRow>\n             <InfoLabel>시작 시간:</InfoLabel>\n             {isEditMode ? (\n-              <EditInput\n-                type=\"datetime-local\"\n-                value={editedStartTime}\n-                onChange={(e) => setEditedStartTime(e.target.value)}\n-              />\n+              <div style={{ display: 'flex', gap: '8px', flex: 1 }}>\n+                <EditInput\n+                  type=\"date\"\n+                  value={selectedDate}\n+                  onChange={(e) => setSelectedDate(e.target.value)}\n+                  style={{ flex: 1 }}\n+                />\n+                <EditInput\n+                  type=\"time\"\n+                  value={selectedTime}\n+                  onChange={(e) => setSelectedTime(e.target.value)}\n+                  step=\"1800\"\n+                  style={{ flex: 1 }}\n+                />\n+              </div>\n             ) : (\n               <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n             )}\n           </InfoRow>\n \n           <InfoRow>\n             <InfoLabel>종료 시간:</InfoLabel>\n-            {isEditMode ? (\n-              <EditInput\n-                type=\"datetime-local\"\n-                value={editedEndTime}\n-                onChange={(e) => setEditedEndTime(e.target.value)}\n-              />\n-            ) : (\n-              <InfoValue>{formatDateTime(event.endTime)}</InfoValue>\n-            )}\n+            <InfoValue>\n+              {isEditMode && selectedDate && selectedTime\n+                ? formatDateTime(calculateEndTime(selectedDate, selectedTime) || event.endTime)\n+                : formatDateTime(event.endTime)}\n+            </InfoValue>\n           </InfoRow>\n         </Section>\n \n         <Section>\n"
                },
                {
                    "date": 1763866574832,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -283,8 +283,26 @@\n         return '예약';\n     }\n   };\n \n+  // 30분 단위 시간 옵션 생성 (6:00 ~ 22:00)\n+  const generateTimeOptions = () => {\n+    const options = [];\n+    for (let hour = 6; hour <= 22; hour++) {\n+      for (let minute = 0; minute < 60; minute += 30) {\n+        const timeValue = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;\n+        const displayTime = `${hour}:${String(minute).padStart(2, '0')}`;\n+        options.push({ value: timeValue, label: displayTime });\n+        \n+        // 22시는 00분만 추가하고 30분은 제외\n+        if (hour === 22) break;\n+      }\n+    }\n+    return options;\n+  };\n+\n+  const timeOptions = generateTimeOptions();\n+\n   // 메모 개별 저장\n   const handleMemoSave = async () => {\n     if (memo === event.reservationMemo) {\n       toast.info('변경된 내용이 없습니다.');\n@@ -478,15 +496,20 @@\n                   value={selectedDate}\n                   onChange={(e) => setSelectedDate(e.target.value)}\n                   style={{ flex: 1 }}\n                 />\n-                <EditInput\n-                  type=\"time\"\n+                <EditSelect\n                   value={selectedTime}\n                   onChange={(e) => setSelectedTime(e.target.value)}\n-                  step=\"1800\"\n                   style={{ flex: 1 }}\n-                />\n+                >\n+                  <option value=\"\">시간 선택</option>\n+                  {timeOptions.map(option => (\n+                    <option key={option.value} value={option.value}>\n+                      {option.label}\n+                    </option>\n+                  ))}\n+                </EditSelect>\n               </div>\n             ) : (\n               <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n             )}\n"
                },
                {
                    "date": 1763984384403,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -423,9 +423,36 @@\n     }\n \n     setLoading(true);\n     try {\n+      // 1. 예약 삭제\n       await dbManager.deleteScheduleEvent(event.id);\n+      \n+      // 2. 횟수제 일반 예약인 경우 completedSessions 복귀\n+      // event.sourceId는 courseEnrollment.id를 저장하고 있음\n+      if (event.type === 'class' && event.sourceId) {\n+        try {\n+          const enrollment = await dbManager.getCourseEnrollmentById(event.sourceId);\n+          \n+          if (enrollment && enrollment.programType === '횟수제') {\n+            // completedSessions를 1 감소 (0 미만으로 내려가지 않도록)\n+            const newCompletedSessions = Math.max(0, (enrollment.completedSessions || 0) - 1);\n+            \n+            await dbManager.updateCourseEnrollment(enrollment.id, {\n+              completedSessions: newCompletedSessions,\n+              // 완료 상태였다면 다시 활성화\n+              enrollmentStatus: enrollment.enrollmentStatus === 'completed' ? 'active' : enrollment.enrollmentStatus,\n+              updatedAt: new Date()\n+            });\n+            \n+            console.log(`횟수제 수강권 복귀: ${enrollment.productName}, 완료횟수 ${enrollment.completedSessions} → ${newCompletedSessions}`);\n+          }\n+        } catch (enrollmentError) {\n+          console.error('수강권 횟수 복귀 실패:', enrollmentError);\n+          // 수강권 복귀 실패해도 예약 삭제는 성공으로 간주\n+        }\n+      }\n+      \n       toast.success('예약이 삭제되었습니다.');\n       onDelete(event.id);\n       onClose();\n     } catch (error) {\n"
                },
                {
                    "date": 1763984635967,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -423,42 +423,23 @@\n     }\n \n     setLoading(true);\n     try {\n-      // 1. 예약 삭제\n-      await dbManager.deleteScheduleEvent(event.id);\n+      // 이벤트 소싱 방식: 상태만 변경 (물리적 삭제 안함)\n+      // status를 'cancelled'로 변경하여 히스토리 유지\n+      await dbManager.updateScheduleEvent(event.id, {\n+        status: 'cancelled',\n+        updatedAt: new Date()\n+      });\n       \n-      // 2. 횟수제 일반 예약인 경우 completedSessions 복귀\n-      // event.sourceId는 courseEnrollment.id를 저장하고 있음\n-      if (event.type === 'class' && event.sourceId) {\n-        try {\n-          const enrollment = await dbManager.getCourseEnrollmentById(event.sourceId);\n-          \n-          if (enrollment && enrollment.programType === '횟수제') {\n-            // completedSessions를 1 감소 (0 미만으로 내려가지 않도록)\n-            const newCompletedSessions = Math.max(0, (enrollment.completedSessions || 0) - 1);\n-            \n-            await dbManager.updateCourseEnrollment(enrollment.id, {\n-              completedSessions: newCompletedSessions,\n-              // 완료 상태였다면 다시 활성화\n-              enrollmentStatus: enrollment.enrollmentStatus === 'completed' ? 'active' : enrollment.enrollmentStatus,\n-              updatedAt: new Date()\n-            });\n-            \n-            console.log(`횟수제 수강권 복귀: ${enrollment.productName}, 완료횟수 ${enrollment.completedSessions} → ${newCompletedSessions}`);\n-          }\n-        } catch (enrollmentError) {\n-          console.error('수강권 횟수 복귀 실패:', enrollmentError);\n-          // 수강권 복귀 실패해도 예약 삭제는 성공으로 간주\n-        }\n-      }\n+      console.log(`예약 취소 (이벤트 소싱): ${event.id}, status: active → cancelled`);\n       \n-      toast.success('예약이 삭제되었습니다.');\n+      toast.success('예약이 취소되었습니다.');\n       onDelete(event.id);\n       onClose();\n     } catch (error) {\n-      console.error('예약 삭제 실패:', error);\n-      toast.error('예약 삭제에 실패했습니다.');\n+      console.error('예약 취소 실패:', error);\n+      toast.error('예약 취소에 실패했습니다.');\n     } finally {\n       setLoading(false);\n     }\n   };\n"
                },
                {
                    "date": 1763986130469,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -4,8 +4,9 @@\n import { AppColors } from '../styles/colors';\n import { AppTextStyles } from '../styles/textStyles';\n import { dbManager } from '../utils/indexedDB';\n import { ScheduleEvent } from './Calendar/types';\n+import type { DailyScheduleSettings } from '../utils/db/types';\n import Modal from './Modal';\n \n // 스타일 컴포넌트들\n const ModalContent = styled.div`\n@@ -108,8 +109,59 @@\n     }\n   }};\n `;\n \n+const TimeSlotGrid = styled.div`\n+  display: grid;\n+  grid-template-columns: repeat(6, 1fr);\n+  gap: 6px;\n+  padding: 12px;\n+  background-color: ${AppColors.background};\n+  border-radius: 8px;\n+  border: 1px solid ${AppColors.borderLight};\n+  max-height: 200px;\n+  overflow-y: auto;\n+`;\n+\n+const TimeSlotButton = styled.button<{ $isSelected: boolean; $isDisabled: boolean }>`\n+  padding: 8px 4px;\n+  border-radius: 4px;\n+  font-size: 12px;\n+  font-weight: 500;\n+  cursor: ${props => props.$isDisabled ? 'not-allowed' : 'pointer'};\n+  border: 1px solid ${props => {\n+    if (props.$isDisabled) return AppColors.borderLight;\n+    if (props.$isSelected) return AppColors.primary;\n+    return AppColors.borderLight;\n+  }};\n+  background-color: ${props => {\n+    if (props.$isDisabled) return AppColors.surface + '50';\n+    if (props.$isSelected) return AppColors.primary;\n+    return AppColors.surface;\n+  }};\n+  color: ${props => {\n+    if (props.$isDisabled) return AppColors.onSurface + '40';\n+    if (props.$isSelected) return AppColors.onPrimary;\n+    return AppColors.onSurface;\n+  }};\n+  transition: all 0.2s ease;\n+  white-space: nowrap;\n+  \n+  &:hover {\n+    ${props => !props.$isDisabled && `\n+      background-color: ${props.$isSelected ? AppColors.primary + 'dd' : AppColors.primary + '20'};\n+      border-color: ${AppColors.primary};\n+    `}\n+  }\n+`;\n+\n+const TimeSelectionLabel = styled.div`\n+  ${AppTextStyles.body2}\n+  font-weight: 600;\n+  color: ${AppColors.onSurface};\n+  margin-bottom: 8px;\n+`;\n+\n const MemoTextArea = styled.textarea<{ $readOnly?: boolean }>`\n   width: 100%;\n   min-height: 100px;\n   padding: 12px;\n@@ -194,17 +246,19 @@\n     id: string;\n     role: 'master' | 'coach' | 'admin';\n     name?: string;\n   };\n+  dailyScheduleSettings?: DailyScheduleSettings[]; // 일별 스케줄 설정 (근무시간, 휴게시간)\n }\n \n const ReservationEditModal: React.FC<ReservationEditModalProps> = ({\n   isOpen,\n   onClose,\n   event,\n   onUpdate,\n   onDelete,\n-  currentUser\n+  currentUser,\n+  dailyScheduleSettings = []\n }) => {\n   const [isEditMode, setIsEditMode] = useState(false);\n   const [memo, setMemo] = useState(event.reservationMemo || '');\n   const [loading, setLoading] = useState(false);\n@@ -214,9 +268,9 @@\n   const [editedType, setEditedType] = useState<'class' | 'consultation' | 'other'>(\n     event.type as 'class' | 'consultation' | 'other'\n   );\n   const [selectedDate, setSelectedDate] = useState('');\n-  const [selectedTime, setSelectedTime] = useState('');\n+  const [selectedTimeMinutes, setSelectedTimeMinutes] = useState<number>(0); // 분 단위로 변경\n \n   // 현재 시간보다 지났는지 확인\n   const now = new Date();\n   const eventStartTime = new Date(event.startTime);\n@@ -235,34 +289,104 @@\n     return duration;\n   };\n \n   // 종료 시간 자동 계산\n-  const calculateEndTime = (startDateStr: string, startTimeStr: string) => {\n-    if (!startDateStr || !startTimeStr) return '';\n+  const calculateEndTime = (startDateStr: string, startMinutes: number) => {\n+    if (!startDateStr || startMinutes < 0) return null;\n     \n-    const [hours, minutes] = startTimeStr.split(':');\n     const startDateTime = new Date(startDateStr);\n-    startDateTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n+    const hours = Math.floor(startMinutes / 60);\n+    const minutes = startMinutes % 60;\n+    startDateTime.setHours(hours, minutes, 0, 0);\n     \n     const duration = getDuration();\n     const endDateTime = new Date(startDateTime.getTime() + duration * 60 * 1000);\n     \n     return endDateTime;\n   };\n \n+  // 30분 단위 타임슬롯 생성 함수\n+  const generateTimeSlots = (startMinutes: number, endMinutes: number): number[] => {\n+    const slots: number[] = [];\n+    for (let time = startMinutes; time < endMinutes; time += 30) {\n+      slots.push(time);\n+    }\n+    return slots;\n+  };\n+\n+  // 분을 시간 문자열로 변환 (예: 540 -> \"9:00\")\n+  const minutesToTimeString = (minutes: number): string => {\n+    const hours = Math.floor(minutes / 60);\n+    const mins = minutes % 60;\n+    return `${hours}:${String(mins).padStart(2, '0')}`;\n+  };\n+\n+  // 특정 타임슬롯이 휴게시간에 포함되는지 확인\n+  const isTimeSlotInBreak = (slotStart: number): boolean => {\n+    if (!selectedDate || !event.staffId) return false;\n+    \n+    const daySettings = dailyScheduleSettings.find(\n+      s => s.staffId === event.staffId && s.date === selectedDate\n+    );\n+    \n+    if (!daySettings) return false;\n+    \n+    const slotEnd = slotStart + 30;\n+    \n+    // 기본 휴게시간 확인\n+    if (daySettings.lunchTime && daySettings.lunchTime.start > 0 && daySettings.lunchTime.end > 0) {\n+      if (slotStart >= daySettings.lunchTime.start && slotEnd <= daySettings.lunchTime.end) {\n+        return true;\n+      }\n+    }\n+    \n+    // 추가 휴게시간들 확인\n+    if (daySettings.breakTimes && daySettings.breakTimes.length > 0) {\n+      for (const breakTime of daySettings.breakTimes) {\n+        if (breakTime.start > 0 && breakTime.end > 0) {\n+          if (slotStart >= breakTime.start && slotEnd <= breakTime.end) {\n+            return true;\n+          }\n+        }\n+      }\n+    }\n+    \n+    return false;\n+  };\n+\n+  // 근무 가능한 시간 범위 가져오기\n+  const getWorkingHours = (): { start: number; end: number } => {\n+    if (!selectedDate || !event.staffId) {\n+      return { start: 6 * 60, end: 22 * 60 }; // 기본값: 6:00 ~ 22:00\n+    }\n+    \n+    const daySettings = dailyScheduleSettings.find(\n+      s => s.staffId === event.staffId && s.date === selectedDate\n+    );\n+    \n+    if (!daySettings || !daySettings.workingHours) {\n+      return { start: 6 * 60, end: 22 * 60 }; // 기본값\n+    }\n+    \n+    return {\n+      start: daySettings.workingHours.start,\n+      end: daySettings.workingHours.end\n+    };\n+  };\n+\n   useEffect(() => {\n     setMemo(event.reservationMemo || '');\n     setEditedType(event.type as 'class' | 'consultation' | 'other');\n     \n     const startDate = new Date(event.startTime);\n     const year = startDate.getFullYear();\n     const month = String(startDate.getMonth() + 1).padStart(2, '0');\n     const day = String(startDate.getDate()).padStart(2, '0');\n-    const hours = String(startDate.getHours()).padStart(2, '0');\n-    const minutes = String(startDate.getMinutes()).padStart(2, '0');\n+    const hours = startDate.getHours();\n+    const minutes = startDate.getMinutes();\n     \n     setSelectedDate(`${year}-${month}-${day}`);\n-    setSelectedTime(`${hours}:${minutes}`);\n+    setSelectedTimeMinutes(hours * 60 + minutes); // 분 단위로 저장\n   }, [event]);\n \n   const formatDateTime = (date: Date) => {\n     const year = date.getFullYear();\n@@ -283,26 +407,8 @@\n         return '예약';\n     }\n   };\n \n-  // 30분 단위 시간 옵션 생성 (6:00 ~ 22:00)\n-  const generateTimeOptions = () => {\n-    const options = [];\n-    for (let hour = 6; hour <= 22; hour++) {\n-      for (let minute = 0; minute < 60; minute += 30) {\n-        const timeValue = `${String(hour).padStart(2, '0')}:${String(minute).padStart(2, '0')}`;\n-        const displayTime = `${hour}:${String(minute).padStart(2, '0')}`;\n-        options.push({ value: timeValue, label: displayTime });\n-        \n-        // 22시는 00분만 추가하고 30분은 제외\n-        if (hour === 22) break;\n-      }\n-    }\n-    return options;\n-  };\n-\n-  const timeOptions = generateTimeOptions();\n-\n   // 메모 개별 저장\n   const handleMemoSave = async () => {\n     if (memo === event.reservationMemo) {\n       toast.info('변경된 내용이 없습니다.');\n@@ -341,14 +447,15 @@\n \n     setLoading(true);\n     try {\n       // 시작 시간 생성\n-      const [hours, minutes] = selectedTime.split(':');\n+      const hours = Math.floor(selectedTimeMinutes / 60);\n+      const minutes = selectedTimeMinutes % 60;\n       const startTime = new Date(selectedDate);\n-      startTime.setHours(parseInt(hours), parseInt(minutes), 0, 0);\n+      startTime.setHours(hours, minutes, 0, 0);\n       \n       // 종료 시간 자동 계산\n-      const endTime = calculateEndTime(selectedDate, selectedTime);\n+      const endTime = calculateEndTime(selectedDate, selectedTimeMinutes);\n \n       if (!endTime) {\n         toast.error('시간 정보가 올바르지 않습니다.');\n         setLoading(false);\n@@ -404,13 +511,13 @@\n     const startDate = new Date(event.startTime);\n     const year = startDate.getFullYear();\n     const month = String(startDate.getMonth() + 1).padStart(2, '0');\n     const day = String(startDate.getDate()).padStart(2, '0');\n-    const hours = String(startDate.getHours()).padStart(2, '0');\n-    const minutes = String(startDate.getMinutes()).padStart(2, '0');\n+    const hours = startDate.getHours();\n+    const minutes = startDate.getMinutes();\n     \n     setSelectedDate(`${year}-${month}-${day}`);\n-    setSelectedTime(`${hours}:${minutes}`);\n+    setSelectedTimeMinutes(hours * 60 + minutes);\n   };\n \n   const handleDelete = async () => {\n     if (!canEdit) {\n@@ -497,27 +604,41 @@\n \n           <InfoRow>\n             <InfoLabel>시작 시간:</InfoLabel>\n             {isEditMode ? (\n-              <div style={{ display: 'flex', gap: '8px', flex: 1 }}>\n+              <div style={{ display: 'flex', flexDirection: 'column', gap: '8px', flex: 1 }}>\n                 <EditInput\n                   type=\"date\"\n                   value={selectedDate}\n                   onChange={(e) => setSelectedDate(e.target.value)}\n-                  style={{ flex: 1 }}\n                 />\n-                <EditSelect\n-                  value={selectedTime}\n-                  onChange={(e) => setSelectedTime(e.target.value)}\n-                  style={{ flex: 1 }}\n-                >\n-                  <option value=\"\">시간 선택</option>\n-                  {timeOptions.map(option => (\n-                    <option key={option.value} value={option.value}>\n-                      {option.label}\n-                    </option>\n-                  ))}\n-                </EditSelect>\n+                <div>\n+                  <TimeSelectionLabel>시간 선택 (30분 단위)</TimeSelectionLabel>\n+                  <TimeSlotGrid>\n+                    {(() => {\n+                      const workingHours = getWorkingHours();\n+                      const slots = generateTimeSlots(workingHours.start, workingHours.end);\n+                      \n+                      return slots.map(slotStart => {\n+                        const isInBreak = isTimeSlotInBreak(slotStart);\n+                        const isSelected = selectedTimeMinutes === slotStart;\n+                        \n+                        return (\n+                          <TimeSlotButton\n+                            key={slotStart}\n+                            type=\"button\"\n+                            $isSelected={isSelected}\n+                            $isDisabled={isInBreak}\n+                            onClick={() => !isInBreak && setSelectedTimeMinutes(slotStart)}\n+                            title={isInBreak ? '휴게시간' : undefined}\n+                          >\n+                            {minutesToTimeString(slotStart)}\n+                          </TimeSlotButton>\n+                        );\n+                      });\n+                    })()}\n+                  </TimeSlotGrid>\n+                </div>\n               </div>\n             ) : (\n               <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n             )}\n@@ -525,10 +646,10 @@\n \n           <InfoRow>\n             <InfoLabel>종료 시간:</InfoLabel>\n             <InfoValue>\n-              {isEditMode && selectedDate && selectedTime\n-                ? formatDateTime(calculateEndTime(selectedDate, selectedTime) || event.endTime)\n+              {isEditMode && selectedDate && selectedTimeMinutes >= 0\n+                ? formatDateTime(calculateEndTime(selectedDate, selectedTimeMinutes) || event.endTime)\n                 : formatDateTime(event.endTime)}\n             </InfoValue>\n           </InfoRow>\n         </Section>\n"
                },
                {
                    "date": 1765688280168,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,13 @@\n-import React, { useState, useEffect } from 'react';\n+import React, { useState, useEffect, useCallback } from 'react';\n import styled from 'styled-components';\n import { toast } from 'react-toastify';\n import { AppColors } from '../styles/colors';\n import { AppTextStyles } from '../styles/textStyles';\n import { dbManager } from '../utils/indexedDB';\n import { ScheduleEvent } from './Calendar/types';\n-import type { DailyScheduleSettings } from '../utils/db/types';\n+import type { DailyScheduleSettings, CourseEnrollment } from '../utils/db/types';\n+import { getRemainingSessionsCount, getCompletedSessions } from '../utils/db/ReservationHelper';\n import Modal from './Modal';\n \n // 스타일 컴포넌트들\n const ModalContent = styled.div`\n@@ -190,8 +191,54 @@\n   justify-content: flex-end;\n   margin-top: 8px;\n `;\n \n+const MembershipInfoCard = styled.div`\n+  background-color: ${AppColors.background};\n+  border: 1px solid ${AppColors.borderLight};\n+  border-radius: 8px;\n+  padding: 16px;\n+  margin-bottom: 8px;\n+`;\n+\n+const MembershipTitle = styled.div`\n+  ${AppTextStyles.body1}\n+  font-weight: 600;\n+  color: ${AppColors.onBackground};\n+  margin-bottom: 12px;\n+`;\n+\n+const MembershipDetail = styled.div`\n+  display: flex;\n+  justify-content: space-between;\n+  align-items: center;\n+  margin-bottom: 8px;\n+  \n+  &:last-child {\n+    margin-bottom: 0;\n+  }\n+`;\n+\n+const MembershipLabel = styled.span`\n+  ${AppTextStyles.body2}\n+  color: ${AppColors.onSurface};\n+`;\n+\n+const MembershipValue = styled.span<{ $type?: 'primary' | 'warning' | 'success' }>`\n+  ${AppTextStyles.body2}\n+  font-weight: 600;\n+  color: ${props => {\n+    switch (props.$type) {\n+      case 'warning':\n+        return '#f59e0b';\n+      case 'success':\n+        return '#10b981';\n+      default:\n+        return AppColors.primary;\n+    }\n+  }};\n+`;\n+\n const Button = styled.button<{ $variant?: 'primary' | 'secondary' | 'danger' }>`\n   padding: 10px 20px;\n   border-radius: 8px;\n   font-size: ${AppTextStyles.body1.fontSize};\n@@ -263,8 +310,16 @@\n   const [memo, setMemo] = useState(event.reservationMemo || '');\n   const [loading, setLoading] = useState(false);\n   const [memoSaving, setMemoSaving] = useState(false);\n   \n+  // 회원권 정보 상태\n+  const [membershipInfo, setMembershipInfo] = useState<{\n+    enrollment: CourseEnrollment;\n+    completedSessions: number;\n+    remainingSessions: number;\n+  } | null>(null);\n+  const [membershipLoading, setMembershipLoading] = useState(false);\n+  \n   // 수정 가능한 필드들\n   const [editedType, setEditedType] = useState<'class' | 'consultation' | 'other'>(\n     event.type as 'class' | 'consultation' | 'other'\n   );\n@@ -331,16 +386,9 @@\n     if (!daySettings) return false;\n     \n     const slotEnd = slotStart + 30;\n     \n-    // 기본 휴게시간 확인\n-    if (daySettings.lunchTime && daySettings.lunchTime.start > 0 && daySettings.lunchTime.end > 0) {\n-      if (slotStart >= daySettings.lunchTime.start && slotEnd <= daySettings.lunchTime.end) {\n-        return true;\n-      }\n-    }\n-    \n-    // 추가 휴게시간들 확인\n+    // 모든 휴게시간 확인\n     if (daySettings.breakTimes && daySettings.breakTimes.length > 0) {\n       for (const breakTime of daySettings.breakTimes) {\n         if (breakTime.start > 0 && breakTime.end > 0) {\n           if (slotStart >= breakTime.start && slotEnd <= breakTime.end) {\n@@ -372,8 +420,41 @@\n       end: daySettings.workingHours.end\n     };\n   };\n \n+  // 회원권 정보 로딩 함수\n+  const loadMembershipInfo = useCallback(async () => {\n+    if (!event.enrollmentId || !event.memberId) {\n+      setMembershipInfo(null);\n+      return;\n+    }\n+\n+    setMembershipLoading(true);\n+    try {\n+      // 수강권 정보 조회\n+      const enrollment = await dbManager.getCourseEnrollmentById(event.enrollmentId);\n+      if (!enrollment || enrollment.programType !== '횟수제') {\n+        setMembershipInfo(null);\n+        return;\n+      }\n+\n+      // 완료된 세션 수와 남은 세션 수 계산\n+      const completedSessions = await getCompletedSessions(event.enrollmentId);\n+      const remainingSessions = await getRemainingSessionsCount(enrollment);\n+\n+      setMembershipInfo({\n+        enrollment,\n+        completedSessions,\n+        remainingSessions\n+      });\n+    } catch (error) {\n+      console.error('회원권 정보 로딩 실패:', error);\n+      setMembershipInfo(null);\n+    } finally {\n+      setMembershipLoading(false);\n+    }\n+  }, [event.enrollmentId, event.memberId]);\n+\n   useEffect(() => {\n     setMemo(event.reservationMemo || '');\n     setEditedType(event.type as 'class' | 'consultation' | 'other');\n     \n@@ -385,9 +466,12 @@\n     const minutes = startDate.getMinutes();\n     \n     setSelectedDate(`${year}-${month}-${day}`);\n     setSelectedTimeMinutes(hours * 60 + minutes); // 분 단위로 저장\n-  }, [event]);\n+    \n+    // 회원권 정보 로딩\n+    loadMembershipInfo();\n+  }, [event, loadMembershipInfo]);\n \n   const formatDateTime = (date: Date) => {\n     const year = date.getFullYear();\n     const month = String(date.getMonth() + 1).padStart(2, '0');\n@@ -653,8 +737,72 @@\n             </InfoValue>\n           </InfoRow>\n         </Section>\n \n+        {/* 회원권 정보 섹션 - 횟수제 상품인 경우만 표시 */}\n+        {event.enrollmentId && (\n+          <Section>\n+            <SectionTitle>사용한 회원권 정보</SectionTitle>\n+            {membershipLoading ? (\n+              <InfoValue style={{ textAlign: 'center', padding: '20px' }}>로딩 중...</InfoValue>\n+            ) : membershipInfo ? (\n+              <MembershipInfoCard>\n+                <MembershipTitle>{membershipInfo.enrollment.productName}</MembershipTitle>\n+                <MembershipDetail>\n+                  <MembershipLabel>상품 유형:</MembershipLabel>\n+                  <MembershipValue>{membershipInfo.enrollment.programType}</MembershipValue>\n+                </MembershipDetail>\n+                <MembershipDetail>\n+                  <MembershipLabel>총 수업 횟수:</MembershipLabel>\n+                  <MembershipValue>{membershipInfo.enrollment.sessionCount}회</MembershipValue>\n+                </MembershipDetail>\n+                <MembershipDetail>\n+                  <MembershipLabel>완료된 수업:</MembershipLabel>\n+                  <MembershipValue $type=\"success\">{membershipInfo.completedSessions}회</MembershipValue>\n+                </MembershipDetail>\n+                <MembershipDetail>\n+                  <MembershipLabel>남은 수업 횟수:</MembershipLabel>\n+                  <MembershipValue \n+                    $type={membershipInfo.remainingSessions <= 3 ? 'warning' : 'primary'}\n+                  >\n+                    {membershipInfo.remainingSessions}회\n+                  </MembershipValue>\n+                </MembershipDetail>\n+                <MembershipDetail>\n+                  <MembershipLabel>수강권 상태:</MembershipLabel>\n+                  <MembershipValue \n+                    $type={membershipInfo.enrollment.enrollmentStatus === 'active' ? 'success' : 'warning'}\n+                  >\n+                    {membershipInfo.enrollment.enrollmentStatus === 'active' ? '활성' : \n+                     membershipInfo.enrollment.enrollmentStatus === 'completed' ? '완료' :\n+                     membershipInfo.enrollment.enrollmentStatus === 'cancelled' ? '취소' : '기타'}\n+                  </MembershipValue>\n+                </MembershipDetail>\n+                {membershipInfo.enrollment.endDate && (\n+                  <MembershipDetail>\n+                    <MembershipLabel>유효 기간:</MembershipLabel>\n+                    <MembershipValue>\n+                      {new Date(membershipInfo.enrollment.endDate).toLocaleDateString()}\n+                    </MembershipValue>\n+                  </MembershipDetail>\n+                )}\n+                {membershipInfo.enrollment.unpaidAmount > 0 && (\n+                  <MembershipDetail>\n+                    <MembershipLabel>잔여 미수금:</MembershipLabel>\n+                    <MembershipValue $type=\"warning\">\n+                      {membershipInfo.enrollment.unpaidAmount.toLocaleString()}원\n+                    </MembershipValue>\n+                  </MembershipDetail>\n+                )}\n+              </MembershipInfoCard>\n+            ) : (\n+              <InfoValue style={{ color: AppColors.onInput1, textAlign: 'center', padding: '20px' }}>\n+                회원권 정보를 불러올 수 없습니다.\n+              </InfoValue>\n+            )}\n+          </Section>\n+        )}\n+\n         <Section>\n           <SectionTitle>메모</SectionTitle>\n           <MemoTextArea\n             value={memo}\n"
                },
                {
                    "date": 1765688515451,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -422,24 +422,47 @@\n   };\n \n   // 회원권 정보 로딩 함수\n   const loadMembershipInfo = useCallback(async () => {\n-    if (!event.enrollmentId || !event.memberId) {\n+    if (!event.memberId) {\n       setMembershipInfo(null);\n       return;\n     }\n \n     setMembershipLoading(true);\n     try {\n-      // 수강권 정보 조회\n-      const enrollment = await dbManager.getCourseEnrollmentById(event.enrollmentId);\n+      let enrollment: CourseEnrollment | null = null;\n+\n+      // 1. enrollmentId가 있는 경우 직접 조회\n+      if (event.enrollmentId) {\n+        enrollment = await dbManager.getCourseEnrollmentById(event.enrollmentId);\n+      } \n+      // 2. enrollmentId가 없는 경우 회원의 활성 횟수제 수강권 중에서 찾기\n+      else if (event.programId) {\n+        const memberEnrollments = await dbManager.getCourseEnrollmentsByMember(event.memberId);\n+        // 활성 상태이고, 같은 프로그램의 횟수제 수강권 찾기\n+        const activeEnrollments = memberEnrollments.filter(e => \n+          e.enrollmentStatus === 'active' && \n+          e.programType === '횟수제' &&\n+          e.programId === event.programId\n+        );\n+        \n+        if (activeEnrollments.length > 0) {\n+          // 가장 최근에 등록된 수강권 선택\n+          enrollment = activeEnrollments.sort((a, b) => \n+            new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n+          )[0];\n+        }\n+      }\n+\n       if (!enrollment || enrollment.programType !== '횟수제') {\n         setMembershipInfo(null);\n         return;\n       }\n \n       // 완료된 세션 수와 남은 세션 수 계산\n-      const completedSessions = await getCompletedSessions(event.enrollmentId);\n+      const enrollmentId = enrollment.id;\n+      const completedSessions = await getCompletedSessions(enrollmentId);\n       const remainingSessions = await getRemainingSessionsCount(enrollment);\n \n       setMembershipInfo({\n         enrollment,\n@@ -451,9 +474,9 @@\n       setMembershipInfo(null);\n     } finally {\n       setMembershipLoading(false);\n     }\n-  }, [event.enrollmentId, event.memberId]);\n+  }, [event.enrollmentId, event.memberId, event.programId]);\n \n   useEffect(() => {\n     setMemo(event.reservationMemo || '');\n     setEditedType(event.type as 'class' | 'consultation' | 'other');\n@@ -737,10 +760,10 @@\n             </InfoValue>\n           </InfoRow>\n         </Section>\n \n-        {/* 회원권 정보 섹션 - 횟수제 상품인 경우만 표시 */}\n-        {event.enrollmentId && (\n+        {/* 회원권 정보 섹션 - 회원 ID가 있는 경우 시도 */}\n+        {event.memberId && (\n           <Section>\n             <SectionTitle>사용한 회원권 정보</SectionTitle>\n             {membershipLoading ? (\n               <InfoValue style={{ textAlign: 'center', padding: '20px' }}>로딩 중...</InfoValue>\n"
                }
            ],
            "date": 1763865368702,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect } from 'react';\nimport styled from 'styled-components';\nimport { toast } from 'react-toastify';\nimport { AppColors } from '../styles/colors';\nimport { AppTextStyles } from '../styles/textStyles';\nimport { dbManager } from '../utils/indexedDB';\nimport { ScheduleEvent } from './Calendar/types';\nimport Modal from './Modal';\n\n// 스타일 컴포넌트들\nconst ModalContent = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  padding: 8px;\n  min-width: 500px;\n  max-width: 600px;\n`;\n\nconst Section = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst SectionTitle = styled.h3`\n  ${AppTextStyles.title3}\n  margin: 0;\n  color: ${AppColors.onBackground};\n  border-bottom: 2px solid ${AppColors.primary};\n  padding-bottom: 8px;\n`;\n\nconst InfoRow = styled.div`\n  display: flex;\n  align-items: center;\n  gap: 12px;\n`;\n\nconst InfoLabel = styled.div`\n  ${AppTextStyles.body2}\n  font-weight: 600;\n  color: ${AppColors.onSurface};\n  min-width: 100px;\n`;\n\nconst InfoValue = styled.div`\n  ${AppTextStyles.body1}\n  color: ${AppColors.onBackground};\n  flex: 1;\n`;\n\nconst ReservationTypeTag = styled.span<{ $type: 'class' | 'consultation' | 'other' }>`\n  display: inline-block;\n  padding: 4px 12px;\n  border-radius: 4px;\n  font-size: ${AppTextStyles.label2.fontSize};\n  font-weight: 600;\n  background-color: ${props => {\n    switch (props.$type) {\n      case 'consultation':\n        return '#10b98120';\n      case 'other':\n        return '#f59e0b20';\n      default:\n        return '#3b82f620';\n    }\n  }};\n  color: ${props => {\n    switch (props.$type) {\n      case 'consultation':\n        return '#059669';\n      case 'other':\n        return '#d97706';\n      default:\n        return '#2563eb';\n    }\n  }};\n`;\n\nconst MemoTextArea = styled.textarea<{ $readOnly?: boolean }>`\n  width: 100%;\n  min-height: 100px;\n  padding: 12px;\n  border: 1px solid ${AppColors.borderLight};\n  border-radius: 8px;\n  font-size: ${AppTextStyles.body1.fontSize};\n  font-family: inherit;\n  resize: vertical;\n  box-sizing: border-box;\n  background-color: ${props => props.$readOnly ? AppColors.background : 'white'};\n  \n  &:focus {\n    outline: none;\n    border-color: ${AppColors.primary};\n    box-shadow: 0 0 0 2px ${AppColors.primary}20;\n  }\n\n  &::placeholder {\n    color: ${AppColors.onInput1};\n  }\n`;\n\nconst ButtonGroup = styled.div`\n  display: flex;\n  gap: 12px;\n  justify-content: flex-end;\n  margin-top: 8px;\n`;\n\nconst Button = styled.button<{ $variant?: 'primary' | 'secondary' | 'danger' }>`\n  padding: 10px 20px;\n  border-radius: 8px;\n  font-size: ${AppTextStyles.body1.fontSize};\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  border: none;\n\n  ${props => {\n    switch (props.$variant) {\n      case 'danger':\n        return `\n          background-color: #ef4444;\n          color: white;\n          &:hover:not(:disabled) {\n            background-color: #dc2626;\n          }\n        `;\n      case 'secondary':\n        return `\n          background-color: ${AppColors.background};\n          color: ${AppColors.onSurface};\n          border: 1px solid ${AppColors.borderLight};\n          &:hover:not(:disabled) {\n            background-color: ${AppColors.borderLight};\n          }\n        `;\n      default:\n        return `\n          background-color: ${AppColors.primary};\n          color: ${AppColors.onPrimary};\n          &:hover:not(:disabled) {\n            background-color: ${AppColors.primary}dd;\n          }\n        `;\n    }\n  }}\n\n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n`;\n\nconst WarningText = styled.div`\n  ${AppTextStyles.body3}\n  color: #ef4444;\n  padding: 8px 12px;\n  background-color: #fef2f2;\n  border-radius: 4px;\n  border: 1px solid #fecaca;\n`;\n\ninterface ReservationEditModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  event: ScheduleEvent;\n  onUpdate: (updatedEvent: ScheduleEvent) => void;\n  onDelete: (eventId: string) => void;\n  currentUser?: {\n    id: string;\n    role: 'master' | 'coach' | 'admin';\n    name?: string;\n  };\n}\n\nconst ReservationEditModal: React.FC<ReservationEditModalProps> = ({\n  isOpen,\n  onClose,\n  event,\n  onUpdate,\n  onDelete,\n  currentUser\n}) => {\n  const [memo, setMemo] = useState(event.reservationMemo || '');\n  const [loading, setLoading] = useState(false);\n\n  // 현재 시간보다 지났는지 확인\n  const isPast = new Date() > event.startTime;\n  // 편집 가능 여부 (지나지 않은 예약만 편집 가능)\n  const canEdit = !isPast;\n\n  useEffect(() => {\n    setMemo(event.reservationMemo || '');\n  }, [event]);\n\n  const formatDateTime = (date: Date) => {\n    const year = date.getFullYear();\n    const month = String(date.getMonth() + 1).padStart(2, '0');\n    const day = String(date.getDate()).padStart(2, '0');\n    const hours = String(date.getHours()).padStart(2, '0');\n    const minutes = String(date.getMinutes()).padStart(2, '0');\n    return `${year}년 ${month}월 ${day}일 ${hours}:${minutes}`;\n  };\n\n  const getReservationTypeText = (type: string) => {\n    switch (type) {\n      case 'consultation':\n        return '상담';\n      case 'other':\n        return '기타';\n      default:\n        return '예약';\n    }\n  };\n\n  const handleSave = async () => {\n    if (!canEdit && memo === event.reservationMemo) {\n      // 과거 예약이고 메모 변경이 없으면 그냥 닫기\n      onClose();\n      return;\n    }\n\n    setLoading(true);\n    try {\n      // 메모만 업데이트하거나 전체 이벤트 업데이트\n      const updatedEvent: ScheduleEvent = {\n        ...event,\n        reservationMemo: memo || undefined\n      };\n\n      // DB 업데이트\n      await dbManager.updateScheduleEvent(event.id, {\n        reservationMemo: memo || undefined\n      });\n\n      toast.success('예약이 수정되었습니다.');\n      onUpdate(updatedEvent);\n      onClose();\n    } catch (error) {\n      console.error('예약 수정 실패:', error);\n      toast.error('예약 수정에 실패했습니다.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const handleDelete = async () => {\n    if (!canEdit) {\n      toast.error('지난 예약은 삭제할 수 없습니다.');\n      return;\n    }\n\n    if (!window.confirm('이 예약을 삭제하시겠습니까?')) {\n      return;\n    }\n\n    setLoading(true);\n    try {\n      await dbManager.deleteScheduleEvent(event.id);\n      toast.success('예약이 삭제되었습니다.');\n      onDelete(event.id);\n      onClose();\n    } catch (error) {\n      console.error('예약 삭제 실패:', error);\n      toast.error('예약 삭제에 실패했습니다.');\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={onClose}\n      header=\"예약 상세\"\n      width=\"600px\"\n      body={\n      <ModalContent>\n        {isPast && (\n          <WarningText>\n            ⚠️ 지난 예약은 메모만 수정 가능합니다. 다른 정보는 수정할 수 없습니다.\n          </WarningText>\n        )}\n\n        <Section>\n          <SectionTitle>예약 정보</SectionTitle>\n          \n          <InfoRow>\n            <InfoLabel>예약 유형:</InfoLabel>\n            <InfoValue>\n              <ReservationTypeTag $type={event.type as 'class' | 'consultation' | 'other'}>\n                {getReservationTypeText(event.type)}\n              </ReservationTypeTag>\n            </InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>회원명:</InfoLabel>\n            <InfoValue>{event.memberName || '-'}</InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>담당 코치:</InfoLabel>\n            <InfoValue>{event.staffName}</InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>프로그램:</InfoLabel>\n            <InfoValue>{event.programName || '-'}</InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>지점:</InfoLabel>\n            <InfoValue>{event.branchName || '-'}</InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>시작 시간:</InfoLabel>\n            <InfoValue>{formatDateTime(event.startTime)}</InfoValue>\n          </InfoRow>\n\n          <InfoRow>\n            <InfoLabel>종료 시간:</InfoLabel>\n            <InfoValue>{formatDateTime(event.endTime)}</InfoValue>\n          </InfoRow>\n        </Section>\n\n        <Section>\n          <SectionTitle>메모</SectionTitle>\n          <MemoTextArea\n            value={memo}\n            onChange={(e) => setMemo(e.target.value)}\n            placeholder=\"예약 관련 메모를 입력하세요...\"\n            disabled={loading}\n          />\n        </Section>\n\n        <ButtonGroup>\n          {canEdit && (\n            <Button\n              $variant=\"danger\"\n              onClick={handleDelete}\n              disabled={loading}\n            >\n              삭제\n            </Button>\n          )}\n          <Button\n            $variant=\"secondary\"\n            onClick={onClose}\n            disabled={loading}\n          >\n            취소\n          </Button>\n          <Button\n            $variant=\"primary\"\n            onClick={handleSave}\n            disabled={loading}\n          >\n            {loading ? '저장 중...' : '저장'}\n          </Button>\n        </ButtonGroup>\n      </ModalContent>\n      }\n    />\n  );\n};\n\nexport default ReservationEditModal;\n"
        }
    ]
}