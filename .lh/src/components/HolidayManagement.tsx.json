{
    "sourceFile": "src/components/HolidayManagement.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 1,
            "patches": [
                {
                    "date": 1762169896697,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1763465420256,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -241,9 +241,9 @@\n   const loadStaffList = useCallback(async () => {\n     try {\n       const allStaff = await dbManager.getAllStaff();\n       const activeCoaches = allStaff.filter(staff => \n-        staff.isActive && staff.role === '코치'\n+        staff.isActive && staff.program // 담당 프로그램이 있는 활성 직원\n       );\n       setStaffList(activeCoaches);\n       \n       if (!selectedStaffId && activeCoaches.length > 0) {\n"
                }
            ],
            "date": 1762169896697,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect, useCallback } from 'react';\nimport styled from 'styled-components';\nimport { AppColors } from '../styles/colors';\nimport { AppTextStyles } from '../styles/textStyles';\nimport { dbManager } from '../utils/indexedDB';\nimport type { Staff } from '../utils/db/types';\nimport Calendar from 'react-calendar';\nimport 'react-calendar/dist/Calendar.css';\n\nconst Container = styled.div`\n  padding: 24px;\n  background: ${AppColors.surface};\n  border-radius: 12px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);\n`;\n\nconst Title = styled.h3`\n  ${AppTextStyles.title2}\n  color: ${AppColors.onSurface};\n  margin-bottom: 24px;\n`;\n\nconst StaffSelector = styled.select`\n  width: 100%;\n  max-width: 300px;\n  padding: 12px;\n  border: 1px solid ${AppColors.borderLight};\n  border-radius: 8px;\n  font-size: 14px;\n  margin-bottom: 24px;\n  background: ${AppColors.surface};\n  \n  &:focus {\n    outline: none;\n    border-color: ${AppColors.primary};\n  }\n`;\n\nconst CalendarContainer = styled.div`\n  display: flex;\n  gap: 24px;\n  \n  @media (max-width: 768px) {\n    flex-direction: column;\n  }\n`;\n\nconst CalendarWrapper = styled.div`\n  flex: 1;\n  \n  .react-calendar {\n    width: 100%;\n    background: white;\n    border: 1px solid ${AppColors.borderLight};\n    border-radius: 8px;\n    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.1);\n    font-family: inherit;\n  }\n  \n  .react-calendar__navigation {\n    display: flex;\n    height: 44px;\n    margin-bottom: 1em;\n  }\n  \n  .react-calendar__navigation button {\n    min-width: 44px;\n    background: none;\n    border: none;\n    font-size: 16px;\n    font-weight: bold;\n    color: ${AppColors.onSurface};\n    \n    &:hover {\n      background-color: ${AppColors.btnC};\n    }\n    \n    &:disabled {\n      color: ${AppColors.onBtnC};\n    }\n  }\n  \n  .react-calendar__month-view__weekdays {\n    text-align: center;\n    text-transform: uppercase;\n    font-weight: bold;\n    font-size: 0.75em;\n    color: ${AppColors.onInput2};\n  }\n  \n  .react-calendar__tile {\n    max-width: 100%;\n    padding: 10px 6px;\n    background: none;\n    border: none;\n    text-align: center;\n    line-height: 16px;\n    font-size: 0.833em;\n    color: ${AppColors.onSurface};\n    \n    &:hover {\n      background-color: ${AppColors.btnC};\n    }\n    \n    &:disabled {\n      color: ${AppColors.onBtnC};\n    }\n  }\n  \n  .react-calendar__tile--active {\n    background: ${AppColors.primary} !important;\n    color: white !important;\n  }\n  \n  .react-calendar__tile--now {\n    background: ${AppColors.tertiary};\n    color: white;\n  }\n  \n  .react-calendar__tile--holiday {\n    background-color: ${AppColors.error} !important;\n    color: white !important;\n    font-weight: bold;\n  }\n  \n  .react-calendar__tile--weekend {\n    color: ${AppColors.error};\n  }\n`;\n\nconst InfoPanel = styled.div`\n  flex: 0 0 300px;\n  background: ${AppColors.btnC};\n  border-radius: 8px;\n  padding: 16px;\n`;\n\nconst InfoTitle = styled.h4`\n  ${AppTextStyles.title3}\n  color: ${AppColors.onSurface};\n  margin-bottom: 16px;\n`;\n\nconst HolidayList = styled.div`\n  max-height: 200px;\n  overflow-y: auto;\n`;\n\nconst HolidayItem = styled.div`\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  padding: 8px 0;\n  border-bottom: 1px solid ${AppColors.borderLight};\n  \n  &:last-child {\n    border-bottom: none;\n  }\n`;\n\nconst HolidayDate = styled.span`\n  font-size: 14px;\n  color: ${AppColors.onSurface};\n`;\n\nconst RemoveButton = styled.button`\n  background: ${AppColors.error};\n  color: white;\n  border: none;\n  border-radius: 4px;\n  padding: 4px 8px;\n  font-size: 12px;\n  cursor: pointer;\n  \n  &:hover {\n    background: ${AppColors.buttonPrimaryHover};\n  }\n`;\n\nconst ActionButtons = styled.div`\n  margin-top: 16px;\n  display: flex;\n  gap: 8px;\n`;\n\nconst ActionButton = styled.button<{ variant?: 'primary' | 'secondary' }>`\n  flex: 1;\n  padding: 12px;\n  border: none;\n  border-radius: 8px;\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s ease;\n  \n  ${props => props.variant === 'primary' ? `\n    background: ${AppColors.primary};\n    color: white;\n    \n    &:hover {\n      background: ${AppColors.buttonPrimaryHover};\n    }\n  ` : `\n    background: ${AppColors.btnC};\n    color: ${AppColors.onSurface};\n    \n    &:hover {\n      background: ${AppColors.borderLight};\n    }\n  `}\n  \n  &:disabled {\n    background: ${AppColors.borderLight};\n    color: ${AppColors.onBtnC};\n    cursor: not-allowed;\n  }\n`;\n\nconst StatusText = styled.p`\n  font-size: 14px;\n  color: ${AppColors.onInput2};\n  margin-top: 12px;\n`;\n\ninterface HolidayManagementProps {\n  staffId?: string;\n  onHolidayChange?: (staffId: string, holidays: string[]) => void;\n}\n\nconst HolidayManagement: React.FC<HolidayManagementProps> = ({\n  staffId: initialStaffId,\n  onHolidayChange\n}) => {\n  const [staffList, setStaffList] = useState<Staff[]>([]);\n  const [selectedStaffId, setSelectedStaffId] = useState<string>(initialStaffId || '');\n  const [holidays, setHolidays] = useState<string[]>([]);\n  const [selectedDate, setSelectedDate] = useState<Date | null>(null);\n  const [loading, setLoading] = useState(false);\n\n  // 직원 목록 로드\n  const loadStaffList = useCallback(async () => {\n    try {\n      const allStaff = await dbManager.getAllStaff();\n      const activeCoaches = allStaff.filter(staff => \n        staff.isActive && staff.role === '코치'\n      );\n      setStaffList(activeCoaches);\n      \n      if (!selectedStaffId && activeCoaches.length > 0) {\n        setSelectedStaffId(activeCoaches[0].id);\n      }\n    } catch (error) {\n      console.error('직원 목록 로드 실패:', error);\n    }\n  }, [selectedStaffId]);\n\n  // 선택된 직원의 휴일 목록 로드\n  const loadHolidays = useCallback(async () => {\n    if (!selectedStaffId) return;\n    \n    try {\n      setLoading(true);\n      const staffHolidays = await dbManager.getStaffHolidays(selectedStaffId);\n      setHolidays(staffHolidays);\n    } catch (error) {\n      console.error('휴일 목록 로드 실패:', error);\n    } finally {\n      setLoading(false);\n    }\n  }, [selectedStaffId]);\n\n  useEffect(() => {\n    loadStaffList();\n  }, [loadStaffList]);\n\n  useEffect(() => {\n    loadHolidays();\n  }, [loadHolidays]);\n\n  const handleStaffChange = (event: React.ChangeEvent<HTMLSelectElement>) => {\n    setSelectedStaffId(event.target.value);\n    setSelectedDate(null);\n  };\n\n  const handleDateClick = (date: Date) => {\n    setSelectedDate(date);\n  };\n\n  const formatDate = (date: Date): string => {\n    return date.toISOString().split('T')[0];\n  };\n\n  const addHoliday = async () => {\n    if (!selectedDate || !selectedStaffId) return;\n    \n    try {\n      setLoading(true);\n      const dateString = formatDate(selectedDate);\n      \n      if (!holidays.includes(dateString)) {\n        await dbManager.addStaffHoliday(selectedStaffId, dateString);\n        const updatedHolidays = await dbManager.getStaffHolidays(selectedStaffId);\n        setHolidays(updatedHolidays);\n        \n        onHolidayChange?.(selectedStaffId, updatedHolidays);\n      }\n    } catch (error) {\n      console.error('휴일 추가 실패:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const removeHoliday = async (dateString: string) => {\n    if (!selectedStaffId) return;\n    \n    try {\n      setLoading(true);\n      await dbManager.removeStaffHoliday(selectedStaffId, dateString);\n      const updatedHolidays = await dbManager.getStaffHolidays(selectedStaffId);\n      setHolidays(updatedHolidays);\n      \n      onHolidayChange?.(selectedStaffId, updatedHolidays);\n    } catch (error) {\n      console.error('휴일 제거 실패:', error);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const removeSelectedHoliday = async () => {\n    if (!selectedDate || !selectedStaffId) return;\n    \n    const dateString = formatDate(selectedDate);\n    if (holidays.includes(dateString)) {\n      await removeHoliday(dateString);\n    }\n  };\n\n  const tileClassName = ({ date }: { date: Date }) => {\n    const dateString = formatDate(date);\n    const isHoliday = holidays.includes(dateString);\n    const isWeekend = date.getDay() === 0 || date.getDay() === 6;\n    \n    const classes = [];\n    if (isHoliday) classes.push('react-calendar__tile--holiday');\n    if (isWeekend) classes.push('react-calendar__tile--weekend');\n    \n    return classes.join(' ');\n  };\n\n  const selectedStaff = staffList.find(staff => staff.id === selectedStaffId);\n  const isSelectedDateHoliday = selectedDate ? \n    holidays.includes(formatDate(selectedDate)) : false;\n\n  return (\n    <Container>\n      <Title>직원 휴일 관리</Title>\n      \n      <StaffSelector value={selectedStaffId} onChange={handleStaffChange}>\n        <option value=\"\">직원을 선택하세요</option>\n        {staffList.map(staff => (\n          <option key={staff.id} value={staff.id}>\n            {staff.name}\n          </option>\n        ))}\n      </StaffSelector>\n\n      {selectedStaffId && (\n        <CalendarContainer>\n          <CalendarWrapper>\n            <Calendar\n              onClickDay={handleDateClick}\n              value={selectedDate}\n              tileClassName={tileClassName}\n              locale=\"ko-KR\"\n            />\n          </CalendarWrapper>\n\n          <InfoPanel>\n            <InfoTitle>\n              {selectedStaff?.name}의 휴일 목록\n            </InfoTitle>\n            \n            <HolidayList>\n              {holidays.length === 0 ? (\n                <StatusText>설정된 휴일이 없습니다.</StatusText>\n              ) : (\n                holidays.map(holiday => (\n                  <HolidayItem key={holiday}>\n                    <HolidayDate>{holiday}</HolidayDate>\n                    <RemoveButton onClick={() => removeHoliday(holiday)}>\n                      삭제\n                    </RemoveButton>\n                  </HolidayItem>\n                ))\n              )}\n            </HolidayList>\n\n            {selectedDate && (\n              <>\n                <StatusText>\n                  선택된 날짜: {formatDate(selectedDate)}\n                  {isSelectedDateHoliday ? ' (휴일)' : ' (근무일)'}\n                </StatusText>\n                \n                <ActionButtons>\n                  {isSelectedDateHoliday ? (\n                    <ActionButton \n                      variant=\"secondary\" \n                      onClick={removeSelectedHoliday}\n                      disabled={loading}\n                    >\n                      휴일 해제\n                    </ActionButton>\n                  ) : (\n                    <ActionButton \n                      variant=\"primary\" \n                      onClick={addHoliday}\n                      disabled={loading}\n                    >\n                      휴일 설정\n                    </ActionButton>\n                  )}\n                </ActionButtons>\n              </>\n            )}\n          </InfoPanel>\n        </CalendarContainer>\n      )}\n    </Container>\n  );\n};\n\nexport default HolidayManagement;"
        }
    ]
}