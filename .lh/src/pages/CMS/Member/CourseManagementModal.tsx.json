{
    "sourceFile": "src/pages/CMS/Member/CourseManagementModal.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1762070993750,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762071099912,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -205,16 +205,26 @@\n   const [extendReason, setExtendReason] = useState<string>('');\n \n   // ìˆ˜ê°•ê¶Œ ìœ í˜•ì— ë”°ë¥¸ íƒ­ í•„í„°ë§\n   const getAvailableTabs = useCallback((): TabType[] => {\n-    const tabs: TabType[] = ['transfer'];\n+    const tabs: TabType[] = [];\n     \n+    // í™€ë“œ ìƒíƒœê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì–‘ë„ ê°€ëŠ¥\n+    if (courseEnrollment?.enrollmentStatus !== 'hold') {\n+      tabs.push('transfer');\n+    }\n+    \n     if (courseEnrollment?.programType === 'ê¸°ê°„ì œ') {\n-      tabs.push('hold', 'extend');\n+      tabs.push('hold');\n+      \n+      // í™€ë“œ ìƒíƒœê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì—°ì¥ ê°€ëŠ¥\n+      if (courseEnrollment?.enrollmentStatus !== 'hold') {\n+        tabs.push('extend');\n+      }\n     }\n     \n     return tabs;\n-  }, [courseEnrollment?.programType]);\n+  }, [courseEnrollment?.programType, courseEnrollment?.enrollmentStatus]);\n \n   // íƒ­ëª… ë°˜í™˜\n   const getTabLabel = (tab: TabType): string => {\n     switch (tab) {\n@@ -592,15 +602,33 @@\n         <Section>\n           <SectionTitle>{isCurrentlyHold ? 'í™€ë“œ ì¢…ë£Œ' : 'í™€ë“œ ì‹œì‘'}</SectionTitle>\n           \n           {isCurrentlyHold ? (\n-            <WarningText>\n-              <strong>ğŸ”„ í™€ë“œ ì¢…ë£Œ ì•ˆë‚´</strong><br />\n-              â€¢ í™€ë“œë¥¼ ì¢…ë£Œí•˜ë©´ í™€ë“œ ê¸°ê°„ë§Œí¼ ìˆ˜ê°• ì¢…ë£Œì¼ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n-              â€¢ í™€ë“œ ì‹œì‘ì¼: {courseEnrollment.holdInfo?.holdStartDate ? \n-                new Date(courseEnrollment.holdInfo.holdStartDate).toLocaleDateString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}<br />\n-              â€¢ í™€ë“œ ì‚¬ìœ : {courseEnrollment.holdInfo?.holdReason || 'ì—†ìŒ'}\n-            </WarningText>\n+            <>\n+              <WarningText>\n+                <strong>ğŸ”„ í™€ë“œ ì¢…ë£Œ ì•ˆë‚´</strong><br />\n+                â€¢ í™€ë“œë¥¼ ì¢…ë£Œí•˜ë©´ í™€ë“œ ê¸°ê°„ë§Œí¼ ìˆ˜ê°• ì¢…ë£Œì¼ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n+                â€¢ í™€ë“œ ì‹œì‘ì¼: {courseEnrollment.holdInfo?.holdStartDate ? \n+                  new Date(courseEnrollment.holdInfo.holdStartDate).toLocaleDateString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}<br />\n+                â€¢ í™€ë“œ ì‚¬ìœ : {courseEnrollment.holdInfo?.holdReason || 'ì—†ìŒ'}<br />\n+                â€¢ í˜„ì¬ê¹Œì§€ í™€ë“œ ê¸°ê°„: {courseEnrollment.holdInfo?.holdStartDate ? \n+                  Math.ceil((new Date().getTime() - new Date(courseEnrollment.holdInfo.holdStartDate).getTime()) / (1000 * 60 * 60 * 24)) : 0}ì¼\n+              </WarningText>\n+              \n+              <div style={{ \n+                padding: '12px', \n+                background: '#fff3e0', \n+                borderRadius: '8px',\n+                fontSize: '14px',\n+                color: '#ef6c00',\n+                marginTop: '16px'\n+              }}>\n+                âš ï¸ <strong>í™€ë“œ ìƒíƒœ ì œí•œì‚¬í•­</strong><br />\n+                â€¢ í™€ë“œ ì¤‘ì—ëŠ” ì–‘ë„ ë° ì—°ì¥ì´ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br />\n+                â€¢ ìˆ˜ì—… ì°¸ì—¬ê°€ ì œí•œë©ë‹ˆë‹¤.<br />\n+                â€¢ í™€ë“œë¥¼ ì¢…ë£Œí•˜ì‹œë©´ ë‹¤ì‹œ ì •ìƒ ì´ìš©ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.\n+              </div>\n+            </>\n           ) : (\n             <>\n               <TextField\n                 value={holdReason}\n@@ -612,9 +640,10 @@\n               <WarningText>\n                 <strong>â¸ï¸ í™€ë“œ ì‹œì‘ ì•ˆë‚´</strong><br />\n                 â€¢ í™€ë“œ ì‹œì‘ ì‹œ ìˆ˜ê°• ìƒíƒœê°€ 'í™€ë“œ'ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n                 â€¢ í™€ë“œ ì¢…ë£Œ ì‹œ í™€ë“œ ê¸°ê°„ë§Œí¼ ìˆ˜ê°• ì¢…ë£Œì¼ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n-                â€¢ í™€ë“œ ì¤‘ì—ëŠ” ìˆ˜ì—… ì°¸ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.\n+                â€¢ í™€ë“œ ì¤‘ì—ëŠ” ìˆ˜ì—… ì°¸ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.<br />\n+                â€¢ í™€ë“œ ì¤‘ì—ëŠ” ì–‘ë„ ë° ì—°ì¥ ê¸°ëŠ¥ì´ ì œí•œë©ë‹ˆë‹¤.\n               </WarningText>\n             </>\n           )}\n         </Section>\n"
                },
                {
                    "date": 1762168587919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -6,8 +6,9 @@\n import { dbManager, type Member, type CourseEnrollment } from '../../../utils/indexedDB';\n import Modal from '../../../components/Modal';\n import { TextField } from '../../../components/TextField';\n import DataTable, { type TableColumn } from '../../../components/DataTable';\n+import CustomDropdown from '../../../components/CustomDropdown';\n \n interface CourseManagementModalProps {\n   isOpen: boolean;\n   onClose: () => void;\n@@ -181,8 +182,70 @@\n     }\n   }};\n `;\n \n+const PaymentSection = styled.div`\n+  padding: 16px;\n+  background: ${AppColors.surface};\n+  border: 1px solid ${AppColors.borderLight};\n+  border-radius: 8px;\n+  margin-top: 16px;\n+`;\n+\n+const PaymentRow = styled.div`\n+  display: flex;\n+  align-items: center;\n+  gap: 12px;\n+  margin-bottom: 12px;\n+`;\n+\n+const PaymentLabel = styled.label`\n+  min-width: 80px;\n+  font-size: 14px;\n+  font-weight: 600;\n+  color: ${AppColors.onSurface};\n+`;\n+\n+const PaymentInput = styled.input`\n+  flex: 1;\n+  padding: 8px 12px;\n+  border: 1px solid ${AppColors.borderLight};\n+  border-radius: 6px;\n+  font-size: 14px;\n+  \n+  &:focus {\n+    outline: none;\n+    border-color: ${AppColors.primary};\n+  }\n+  \n+  &:disabled {\n+    background: #f5f5f5;\n+    color: #999;\n+  }\n+`;\n+\n+const FeeInfo = styled.div`\n+  background: #e3f2fd;\n+  border: 1px solid #93c5fd;\n+  border-radius: 8px;\n+  padding: 12px;\n+  margin-top: 12px;\n+  font-size: 14px;\n+  color: #1e40af;\n+  \n+  .fee-amount {\n+    font-weight: 600;\n+    font-size: 16px;\n+    color: ${AppColors.primary};\n+  }\n+`;\n+\n+const BalanceInfo = styled.div`\n+  font-size: 12px;\n+  color: ${AppColors.onInput1};\n+  margin-top: 4px;\n+`;\n+\n const CourseManagementModal: React.FC<CourseManagementModalProps> = ({\n   isOpen,\n   onClose,\n   onSuccess,\n@@ -202,8 +265,13 @@\n   \n   // ì—°ì¥ ê´€ë ¨ ìƒíƒœ\n   const [extendDays, setExtendDays] = useState<number>(30);\n   const [extendReason, setExtendReason] = useState<string>('');\n+  \n+  // ì–‘ë„ ê²°ì œ ê´€ë ¨ ìƒíƒœ\n+  const [transferPaymentMethod, setTransferPaymentMethod] = useState<string>('card');\n+  const [pointPayment, setPointPayment] = useState<number>(0);\n+  const [receiverPointBalance, setReceiverPointBalance] = useState<number>(0);\n \n   // ìˆ˜ê°•ê¶Œ ìœ í˜•ì— ë”°ë¥¸ íƒ­ í•„í„°ë§\n   const getAvailableTabs = useCallback((): TabType[] => {\n     const tabs: TabType[] = [];\n@@ -224,8 +292,14 @@\n     \n     return tabs;\n   }, [courseEnrollment?.programType, courseEnrollment?.enrollmentStatus]);\n \n+  // ì–‘ë„ ìˆ˜ìˆ˜ë£Œ ê³„ì‚° (ì ìš©ê¸ˆì•¡ì˜ 10%)\n+  const getTransferFee = useCallback((): number => {\n+    if (!courseEnrollment?.appliedPrice) return 0;\n+    return Math.floor(courseEnrollment.appliedPrice * 0.1);\n+  }, [courseEnrollment?.appliedPrice]);\n+\n   // íƒ­ëª… ë°˜í™˜\n   const getTabLabel = (tab: TabType): string => {\n     switch (tab) {\n       case 'transfer': return 'ì–‘ë„';\n@@ -283,10 +357,62 @@\n       setFilteredMembers(members);\n     }\n   }, [searchQuery, members]);\n \n-  const handleMemberSelect = (member: Member) => {\n+  // ì–‘ë„ ê²°ì œ ì²˜ë¦¬\n+  const processTransferPayment = async (selectedMember: Member, transferFee: number): Promise<void> => {\n+    const cashPayment = Math.max(0, transferFee - pointPayment);\n+    \n+    // 1. í¬ì¸íŠ¸ ì‚¬ìš© ì²˜ë¦¬ (ìˆëŠ” ê²½ìš°)\n+    if (pointPayment > 0) {\n+      await dbManager.point.usePointsFIFO(\n+        selectedMember.id,\n+        pointPayment,\n+        `transfer_${courseEnrollment?.id}`,\n+        `ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ í¬ì¸íŠ¸ ê²°ì œ`\n+      );\n+    }\n+\n+    // 2. í˜„ê¸ˆ/ì¹´ë“œ/ê³„ì¢Œì´ì²´ ê²°ì œ ê¸°ë¡ ìƒì„± (ìˆëŠ” ê²½ìš°)\n+    if (cashPayment > 0) {\n+      await dbManager.payment.addPayment({\n+        memberId: selectedMember.id,\n+        memberName: selectedMember.name,\n+        branchId: selectedMember.branchId,\n+        branchName: selectedMember.branchName,\n+        coach: selectedMember.coach,\n+        coachName: selectedMember.coachName,\n+        products: [{\n+          id: 'transfer_fee',\n+          name: 'ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ',\n+          price: transferFee,\n+          quantity: 1,\n+          description: `${courseEnrollment?.productName} ì–‘ë„ ìˆ˜ìˆ˜ë£Œ`\n+        }],\n+        totalAmount: transferFee,\n+        paidAmount: transferFee,\n+        unpaidAmount: 0,\n+        paymentStatus: 'completed',\n+        paymentMethod: transferPaymentMethod,\n+        paymentDate: new Date(),\n+        paymentType: 'other',\n+        amount: cashPayment,\n+        memo: `ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ - ${courseEnrollment?.productName}${pointPayment > 0 ? ` (í¬ì¸íŠ¸ ${pointPayment.toLocaleString()}ì› + ${transferPaymentMethod} ${cashPayment.toLocaleString()}ì›)` : ''}`\n+      });\n+    }\n+  };\n+\n+  const handleMemberSelect = async (member: Member) => {\n     setSelectedMember(member);\n+    \n+    // ì„ íƒëœ íšŒì›ì˜ í¬ì¸íŠ¸ ì”ì•¡ ë¡œë“œ\n+    try {\n+      const balance = await dbManager.point.getMemberPointBalanceV2(member.id);\n+      setReceiverPointBalance(balance);\n+    } catch (error) {\n+      console.error('í¬ì¸íŠ¸ ì”ì•¡ ì¡°íšŒ ì‹¤íŒ¨:', error);\n+      setReceiverPointBalance(0);\n+    }\n   };\n \n   // ì–‘ë„ ì²˜ë¦¬\n   const handleTransfer = async () => {\n@@ -294,22 +420,35 @@\n       toast.error('ì–‘ë„í•  ìˆ˜ê°•ê¶Œê³¼ ì–‘ë„ë°›ì„ íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n       return;\n     }\n \n+    const transferFee = getTransferFee();\n+\n+    // ê²°ì œ ê²€ì¦\n+    if (pointPayment > receiverPointBalance) {\n+      toast.error('í¬ì¸íŠ¸ ì”ì•¡ì´ ë¶€ì¡±í•©ë‹ˆë‹¤.');\n+      return;\n+    }\n+\n     try {\n       setIsProcessing(true);\n \n-      // 1. ê¸°ì¡´ ìˆ˜ê°• ì´ë ¥ ì¢…ë£Œ ì²˜ë¦¬\n+      // 1. ì–‘ë„ ìˆ˜ìˆ˜ë£Œ ê²°ì œ ì²˜ë¦¬\n+      if (transferFee > 0) {\n+        await processTransferPayment(selectedMember, transferFee);\n+      }\n+\n+      // 2. ê¸°ì¡´ ìˆ˜ê°• ì´ë ¥ ì¢…ë£Œ ì²˜ë¦¬\n       const updatedOriginalEnrollment: CourseEnrollment = {\n         ...courseEnrollment,\n         enrollmentStatus: 'cancelled',\n         completedSessions: 0,\n-        notes: `${courseEnrollment.notes || ''}\\n[ì–‘ë„] ${new Date().toLocaleDateString()} ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„`.trim()\n+        notes: `${courseEnrollment.notes || ''}\\n[ì–‘ë„] ${new Date().toLocaleDateString()} ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„ (ìˆ˜ìˆ˜ë£Œ: ${transferFee.toLocaleString()}ì›)`.trim()\n       };\n \n       await dbManager.updateCourseEnrollment(courseEnrollment.id, updatedOriginalEnrollment);\n \n-      // 2. ìƒˆë¡œìš´ ìˆ˜ê°• ì´ë ¥ ìƒì„±\n+      // 3. ìƒˆë¡œìš´ ìˆ˜ê°• ì´ë ¥ ìƒì„±\n       const newEnrollment: Omit<CourseEnrollment, 'id' | 'createdAt' | 'updatedAt'> = {\n         memberId: selectedMember.id,\n         memberName: selectedMember.name,\n         productId: courseEnrollment.productId,\n@@ -329,14 +468,16 @@\n         startDate: new Date(),\n         endDate: courseEnrollment.endDate,\n         sessionCount: courseEnrollment.sessionCount,\n         completedSessions: courseEnrollment.completedSessions || 0,\n-        notes: `[ì–‘ë„ë°›ìŒ] ${new Date().toLocaleDateString()} ${courseEnrollment.memberName}ë‹˜ìœ¼ë¡œë¶€í„° ì–‘ë„ë°›ìŒ${memo ? `\\n${memo}` : ''}`\n+        notes: `[ì–‘ë„ë°›ìŒ] ${new Date().toLocaleDateString()} ${courseEnrollment.memberName}ë‹˜ìœ¼ë¡œë¶€í„° ì–‘ë„ë°›ìŒ (ìˆ˜ìˆ˜ë£Œ ì§€ë¶ˆ: ${transferFee.toLocaleString()}ì›)${memo ? `\\n${memo}` : ''}`\n       };\n \n       await dbManager.addCourseEnrollment(newEnrollment);\n-      toast.success(`ìˆ˜ê°•ê¶Œì´ ì„±ê³µì ìœ¼ë¡œ ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n       \n+      const successMessage = `ìˆ˜ê°•ê¶Œì´ ì„±ê³µì ìœ¼ë¡œ ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„ë˜ì—ˆìŠµë‹ˆë‹¤.${transferFee > 0 ? `\\nì–‘ë„ ìˆ˜ìˆ˜ë£Œ: ${transferFee.toLocaleString()}ì›` : ''}`;\n+      toast.success(successMessage);\n+      \n       onSuccess();\n       handleClose();\n \n     } catch (error) {\n@@ -424,8 +565,12 @@\n     setMemo('');\n     setHoldReason('');\n     setExtendDays(30);\n     setExtendReason('');\n+    // ì–‘ë„ ê´€ë ¨ ìƒíƒœ ì´ˆê¸°í™”\n+    setTransferPaymentMethod('card');\n+    setPointPayment(0);\n+    setReceiverPointBalance(0);\n     onClose();\n   };\n \n   // ìˆ˜ê°•ê¶Œ ìƒíƒœ í…ìŠ¤íŠ¸\n@@ -545,55 +690,116 @@\n     </Section>\n   );\n \n   // ì–‘ë„ íƒ­ ë‚´ìš©\n-  const renderTransferContent = () => (\n-    <>\n-      <Section>\n-        <SectionTitle>ì–‘ë„ë°›ì„ íšŒì› ì„ íƒ</SectionTitle>\n-        <SearchContainer>\n+  const renderTransferContent = () => {\n+    const transferFee = getTransferFee();\n+    const cashPayment = Math.max(0, transferFee - pointPayment);\n+    \n+    return (\n+      <>\n+        <Section>\n+          <SectionTitle>ì–‘ë„ë°›ì„ íšŒì› ì„ íƒ</SectionTitle>\n+          <SearchContainer>\n+            <TextField\n+              value={searchQuery}\n+              onChange={(e) => setSearchQuery(e.target.value)}\n+              placeholder=\"íšŒì›ëª…, ì—°ë½ì²˜, ì´ë©”ì¼ë¡œ ê²€ìƒ‰...\"\n+            />\n+            \n+            <MemberTableContainer>\n+              <DataTable\n+                columns={memberColumns}\n+                data={filteredMembers}\n+                loading={loading}\n+                emptyText=\"ê²€ìƒ‰ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤\"\n+                emptyDescription=\"ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”\"\n+                pagination={{\n+                  enabled: false\n+                }}\n+              />\n+            </MemberTableContainer>\n+          </SearchContainer>\n+        </Section>\n+\n+        {/* ì–‘ë„ ìˆ˜ìˆ˜ë£Œ ë° ê²°ì œ ì •ë³´ */}\n+        {selectedMember && (\n+          <Section>\n+            <SectionTitle>ì–‘ë„ ìˆ˜ìˆ˜ë£Œ ê²°ì œ</SectionTitle>\n+            \n+            <FeeInfo>\n+              <div>ì–‘ë„ ìˆ˜ìˆ˜ë£Œ (ìƒí’ˆ ì ìš©ê¸ˆì•¡ì˜ 10%)</div>\n+              <div className=\"fee-amount\">{transferFee.toLocaleString()}ì›</div>\n+            </FeeInfo>\n+\n+            <PaymentSection>\n+              <PaymentRow>\n+                <PaymentLabel>ê²°ì œë°©ë²•</PaymentLabel>\n+                <CustomDropdown\n+                  value={transferPaymentMethod}\n+                  onChange={setTransferPaymentMethod}\n+                  options={[\n+                    { value: 'card', label: 'ì¹´ë“œ' },\n+                    { value: 'cash', label: 'í˜„ê¸ˆ' },\n+                    { value: 'transfer', label: 'ê³„ì¢Œì´ì²´' }\n+                  ]}\n+                  inModal={true}\n+                />\n+              </PaymentRow>\n+\n+              <PaymentRow>\n+                <PaymentLabel>í¬ì¸íŠ¸ ì‚¬ìš©</PaymentLabel>\n+                <PaymentInput\n+                  type=\"number\"\n+                  value={pointPayment}\n+                  onChange={(e) => {\n+                    const value = Math.max(0, Math.min(parseInt(e.target.value) || 0, Math.min(transferFee, receiverPointBalance)));\n+                    setPointPayment(value);\n+                  }}\n+                  placeholder=\"0\"\n+                  max={Math.min(transferFee, receiverPointBalance)}\n+                />\n+                <span style={{ minWidth: '20px', fontSize: '14px' }}>ì›</span>\n+              </PaymentRow>\n+              <BalanceInfo>ì‚¬ìš© ê°€ëŠ¥ í¬ì¸íŠ¸: {receiverPointBalance.toLocaleString()}ì›</BalanceInfo>\n+\n+              <PaymentRow>\n+                <PaymentLabel>{transferPaymentMethod === 'card' ? 'ì¹´ë“œ' : transferPaymentMethod === 'cash' ? 'í˜„ê¸ˆ' : 'ê³„ì¢Œì´ì²´'}</PaymentLabel>\n+                <PaymentInput\n+                  type=\"number\"\n+                  value={cashPayment}\n+                  readOnly\n+                  style={{ background: '#f5f5f5' }}\n+                />\n+                <span style={{ minWidth: '20px', fontSize: '14px' }}>ì›</span>\n+              </PaymentRow>\n+            </PaymentSection>\n+          </Section>\n+        )}\n+\n+        <Section>\n+          <SectionTitle>ì–‘ë„ ê´€ë ¨ ë©”ëª¨</SectionTitle>\n           <TextField\n-            value={searchQuery}\n-            onChange={(e) => setSearchQuery(e.target.value)}\n-            placeholder=\"íšŒì›ëª…, ì—°ë½ì²˜, ì´ë©”ì¼ë¡œ ê²€ìƒ‰...\"\n+            value={memo}\n+            onChange={(e) => setMemo(e.target.value)}\n+            placeholder=\"ì–‘ë„ ê´€ë ¨ ë©”ëª¨ (ì„ íƒì‚¬í•­)\"\n+            multiline\n           />\n-          \n-          <MemberTableContainer>\n-            <DataTable\n-              columns={memberColumns}\n-              data={filteredMembers}\n-              loading={loading}\n-              emptyText=\"ê²€ìƒ‰ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤\"\n-              emptyDescription=\"ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”\"\n-              pagination={{\n-                enabled: false\n-              }}\n-            />\n-          </MemberTableContainer>\n-        </SearchContainer>\n-      </Section>\n+        </Section>\n \n-      <Section>\n-        <SectionTitle>ì–‘ë„ ê´€ë ¨ ë©”ëª¨</SectionTitle>\n-        <TextField\n-          value={memo}\n-          onChange={(e) => setMemo(e.target.value)}\n-          placeholder=\"ì–‘ë„ ê´€ë ¨ ë©”ëª¨ (ì„ íƒì‚¬í•­)\"\n-          multiline\n-        />\n-      </Section>\n+        <WarningText>\n+          <strong>âš ï¸ ì–‘ë„ ì‹œ ì£¼ì˜ì‚¬í•­</strong><br />\n+          â€¢ ì–‘ë„ ìˆ˜ìˆ˜ë£ŒëŠ” ì–‘ë„ë°›ëŠ” íšŒì›ì´ ê²°ì œí•©ë‹ˆë‹¤.<br />\n+          â€¢ ì–‘ë„ í›„ì—ëŠ” ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br />\n+          â€¢ ê¸°ì¡´ íšŒì›ì˜ ìˆ˜ê°• ì´ë ¥ì€ 'ì·¨ì†Œ' ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n+          â€¢ ì–‘ë„ë°›ëŠ” íšŒì›ì˜ ì§€ì ê³¼ ë‹´ë‹¹ ì½”ì¹˜ë¡œ ìë™ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n+          â€¢ ì§„í–‰ëœ ìˆ˜ì—… íšŸìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.<br />\n+          â€¢ ë¯¸ìˆ˜ê¸ˆì´ ìˆëŠ” ê²½ìš° ì–‘ë„ë°›ëŠ” íšŒì›ì´ ìŠ¹ê³„í•©ë‹ˆë‹¤.\n+        </WarningText>\n+      </>\n+    );\n+  };\n \n-      <WarningText>\n-        <strong>âš ï¸ ì–‘ë„ ì‹œ ì£¼ì˜ì‚¬í•­</strong><br />\n-        â€¢ ì–‘ë„ í›„ì—ëŠ” ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br />\n-        â€¢ ê¸°ì¡´ íšŒì›ì˜ ìˆ˜ê°• ì´ë ¥ì€ 'ì·¨ì†Œ' ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n-        â€¢ ì–‘ë„ë°›ëŠ” íšŒì›ì˜ ì§€ì ê³¼ ë‹´ë‹¹ ì½”ì¹˜ë¡œ ìë™ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n-        â€¢ ì§„í–‰ëœ ìˆ˜ì—… íšŸìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.<br />\n-        â€¢ ë¯¸ìˆ˜ê¸ˆì´ ìˆëŠ” ê²½ìš° ì–‘ë„ë°›ëŠ” íšŒì›ì´ ìŠ¹ê³„í•©ë‹ˆë‹¤.\n-      </WarningText>\n-    </>\n-  );\n-\n   // í™€ë“œ íƒ­ ë‚´ìš©\n   const renderHoldContent = () => {\n     const isCurrentlyHold = courseEnrollment.enrollmentStatus === 'hold';\n     \n@@ -707,16 +913,19 @@\n     );\n \n     switch (activeTab) {\n       case 'transfer':\n+        const transferFee = getTransferFee();\n+        const isTransferValid = selectedMember && pointPayment <= receiverPointBalance;\n+        \n         return (\n           <>\n             {cancelButton}\n             <Button \n               onClick={handleTransfer} \n-              disabled={isProcessing || !selectedMember}\n+              disabled={isProcessing || !isTransferValid}\n             >\n-              {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : 'ì–‘ë„ í™•ì¸'}\n+              {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : `ì–‘ë„ í™•ì¸ (ìˆ˜ìˆ˜ë£Œ: ${transferFee.toLocaleString()}ì›)`}\n             </Button>\n           </>\n         );\n       \n"
                },
                {
                    "date": 1762168729073,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -371,9 +371,9 @@\n         `ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ í¬ì¸íŠ¸ ê²°ì œ`\n       );\n     }\n \n-    // 2. í˜„ê¸ˆ/ì¹´ë“œ/ê³„ì¢Œì´ì²´ ê²°ì œ ê¸°ë¡ ìƒì„± (ìˆëŠ” ê²½ìš°)\n+    // 2. í˜„ê¸ˆ/ì¹´ë“œ/ê³„ì¢Œì´ì²´ ê²°ì œ ê¸°ë¡ ìƒì„± (ì‹¤ì œ í˜„ê¸ˆ íë¦„ì´ ìˆëŠ” ê²½ìš°ë§Œ)\n     if (cashPayment > 0) {\n       await dbManager.payment.addPayment({\n         memberId: selectedMember.id,\n         memberName: selectedMember.name,\n@@ -383,21 +383,21 @@\n         coachName: selectedMember.coachName,\n         products: [{\n           id: 'transfer_fee',\n           name: 'ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ',\n-          price: transferFee,\n+          price: cashPayment, // ì‹¤ì œ í˜„ê¸ˆì„± ê²°ì œ ê¸ˆì•¡ë§Œ\n           quantity: 1,\n           description: `${courseEnrollment?.productName} ì–‘ë„ ìˆ˜ìˆ˜ë£Œ`\n         }],\n-        totalAmount: transferFee,\n-        paidAmount: transferFee,\n+        totalAmount: cashPayment, // ì‹¤ì œ í˜„ê¸ˆì„± ê²°ì œ ê¸ˆì•¡\n+        paidAmount: cashPayment,\n         unpaidAmount: 0,\n         paymentStatus: 'completed',\n         paymentMethod: transferPaymentMethod,\n         paymentDate: new Date(),\n         paymentType: 'other',\n         amount: cashPayment,\n-        memo: `ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ - ${courseEnrollment?.productName}${pointPayment > 0 ? ` (í¬ì¸íŠ¸ ${pointPayment.toLocaleString()}ì› + ${transferPaymentMethod} ${cashPayment.toLocaleString()}ì›)` : ''}`\n+        memo: `ìˆ˜ê°•ê¶Œ ì–‘ë„ ìˆ˜ìˆ˜ë£Œ - ${courseEnrollment?.productName} (ì´ ìˆ˜ìˆ˜ë£Œ: ${transferFee.toLocaleString()}ì›${pointPayment > 0 ? `, í¬ì¸íŠ¸ ì‚¬ìš©: ${pointPayment.toLocaleString()}ì›` : ''})`\n       });\n     }\n   };\n \n"
                }
            ],
            "date": 1762070993750,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect, useCallback } from 'react';\nimport styled from 'styled-components';\nimport { toast } from 'react-toastify';\nimport { AppColors } from '../../../styles/colors';\nimport { AppTextStyles } from '../../../styles/textStyles';\nimport { dbManager, type Member, type CourseEnrollment } from '../../../utils/indexedDB';\nimport Modal from '../../../components/Modal';\nimport { TextField } from '../../../components/TextField';\nimport DataTable, { type TableColumn } from '../../../components/DataTable';\n\ninterface CourseManagementModalProps {\n  isOpen: boolean;\n  onClose: () => void;\n  onSuccess: () => void;\n  courseEnrollment: CourseEnrollment | null;\n}\n\ntype TabType = 'transfer' | 'hold' | 'extend';\n\nconst ModalContent = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 24px;\n  padding: 8px 0;\n`;\n\nconst TabContainer = styled.div`\n  display: flex;\n  gap: 4px;\n  border-bottom: 2px solid ${AppColors.borderLight};\n  margin-bottom: 20px;\n`;\n\nconst Tab = styled.button<{ $active: boolean }>`\n  padding: 12px 20px;\n  border: none;\n  background: ${props => props.$active ? AppColors.primary : 'transparent'};\n  color: ${props => props.$active ? AppColors.onPrimary : AppColors.onSurface};\n  font-size: 14px;\n  font-weight: 600;\n  cursor: pointer;\n  border-radius: 8px 8px 0 0;\n  transition: all 0.2s;\n  \n  &:hover {\n    opacity: 0.8;\n  }\n  \n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n  }\n`;\n\nconst Section = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 16px;\n`;\n\nconst SectionTitle = styled.h3`\n  ${AppTextStyles.title3};\n  color: ${AppColors.onSurface};\n  margin: 0;\n  padding-bottom: 8px;\n  border-bottom: 1px solid ${AppColors.borderLight};\n`;\n\nconst InfoGrid = styled.div`\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  gap: 16px;\n  padding: 16px;\n  background: ${AppColors.surface};\n  border-radius: 8px;\n  border: 1px solid ${AppColors.borderLight};\n`;\n\nconst InfoItem = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n`;\n\nconst InfoLabel = styled.span`\n  font-size: 12px;\n  font-weight: 600;\n  color: ${AppColors.onInput1};\n`;\n\nconst InfoValue = styled.span`\n  font-size: 14px;\n  color: ${AppColors.onSurface};\n  font-weight: 500;\n`;\n\nconst SearchContainer = styled.div`\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n`;\n\nconst MemberTableContainer = styled.div`\n  max-height: 300px;\n  overflow-y: auto;\n  border-radius: 8px;\n`;\n\nconst Button = styled.button<{ variant?: 'primary' | 'secondary' | 'danger' }>`\n  padding: 12px 18px;\n  border: ${props => \n    props.variant === 'secondary' ? `1px solid ${AppColors.borderLight}` : \n    props.variant === 'danger' ? `1px solid #d32f2f` : 'none'\n  };\n  border-radius: 8px;\n  background: ${props => \n    props.variant === 'secondary' ? AppColors.surface : \n    props.variant === 'danger' ? '#d32f2f' : AppColors.primary\n  };\n  color: ${props => \n    props.variant === 'secondary' ? AppColors.onSurface : AppColors.onPrimary\n  };\n  font-size: ${AppTextStyles.body1.fontSize};\n  font-weight: 600;\n  cursor: pointer;\n  transition: all 0.2s;\n  \n  &:hover {\n    opacity: 0.9;\n    transform: translateY(-1px);\n  }\n  \n  &:disabled {\n    opacity: 0.5;\n    cursor: not-allowed;\n    transform: none;\n  }\n`;\n\nconst WarningText = styled.div`\n  background: #fff3cd;\n  border: 1px solid #ffeaa7;\n  border-radius: 8px;\n  padding: 12px;\n  color: #856404;\n  font-size: 14px;\n  line-height: 1.4;\n`;\n\nconst SmallTextField = styled(TextField)`\n  width: 120px;\n`;\n\nconst InputRow = styled.div`\n  display: flex;\n  gap: 12px;\n  align-items: end;\n`;\n\nconst StatusBadge = styled.span<{ $status: string }>`\n  padding: 4px 8px;\n  border-radius: 4px;\n  font-size: 12px;\n  font-weight: 600;\n  background: ${props => {\n    switch (props.$status) {\n      case 'active': return '#e8f5e8';\n      case 'hold': return '#fff3e0';\n      case 'completed': return '#e3f2fd';\n      case 'cancelled': return '#ffebee';\n      default: return '#f5f5f5';\n    }\n  }};\n  color: ${props => {\n    switch (props.$status) {\n      case 'active': return '#2e7d32';\n      case 'hold': return '#ef6c00';\n      case 'completed': return '#1976d2';\n      case 'cancelled': return '#d32f2f';\n      default: return '#666';\n    }\n  }};\n`;\n\nconst CourseManagementModal: React.FC<CourseManagementModalProps> = ({\n  isOpen,\n  onClose,\n  onSuccess,\n  courseEnrollment\n}) => {\n  const [activeTab, setActiveTab] = useState<TabType>('transfer');\n  const [searchQuery, setSearchQuery] = useState<string>('');\n  const [members, setMembers] = useState<Member[]>([]);\n  const [filteredMembers, setFilteredMembers] = useState<Member[]>([]);\n  const [selectedMember, setSelectedMember] = useState<Member | null>(null);\n  const [memo, setMemo] = useState<string>('');\n  const [isProcessing, setIsProcessing] = useState<boolean>(false);\n  const [loading, setLoading] = useState<boolean>(false);\n  \n  // í™€ë“œ ê´€ë ¨ ìƒíƒœ\n  const [holdReason, setHoldReason] = useState<string>('');\n  \n  // ì—°ì¥ ê´€ë ¨ ìƒíƒœ\n  const [extendDays, setExtendDays] = useState<number>(30);\n  const [extendReason, setExtendReason] = useState<string>('');\n\n  // ìˆ˜ê°•ê¶Œ ìœ í˜•ì— ë”°ë¥¸ íƒ­ í•„í„°ë§\n  const getAvailableTabs = useCallback((): TabType[] => {\n    const tabs: TabType[] = ['transfer'];\n    \n    if (courseEnrollment?.programType === 'ê¸°ê°„ì œ') {\n      tabs.push('hold', 'extend');\n    }\n    \n    return tabs;\n  }, [courseEnrollment?.programType]);\n\n  // íƒ­ëª… ë°˜í™˜\n  const getTabLabel = (tab: TabType): string => {\n    switch (tab) {\n      case 'transfer': return 'ì–‘ë„';\n      case 'hold': return 'í™€ë“œ';\n      case 'extend': return 'ì—°ì¥';\n      default: return '';\n    }\n  };\n\n  // íšŒì› ëª©ë¡ ë¡œë“œ\n  const loadMembers = useCallback(async () => {\n    try {\n      setLoading(true);\n      const allMembers = await dbManager.getAllMembers();\n      \n      // í˜„ì¬ ìˆ˜ê°•ìƒ ì œì™¸ (ìê¸° ìì‹ ì—ê²ŒëŠ” ì–‘ë„ ë¶ˆê°€)\n      const filteredMembers = allMembers.filter(member => \n        member.id !== courseEnrollment?.memberId && member.isActive\n      );\n      \n      setMembers(filteredMembers);\n      setFilteredMembers(filteredMembers);\n    } catch (error) {\n      console.error('íšŒì› ëª©ë¡ ë¡œë“œ ì‹¤íŒ¨:', error);\n      toast.error('íšŒì› ëª©ë¡ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setLoading(false);\n    }\n  }, [courseEnrollment?.memberId]);\n\n  useEffect(() => {\n    if (isOpen) {\n      // ì²« ë²ˆì§¸ ê°€ëŠ¥í•œ íƒ­ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •\n      const availableTabs = getAvailableTabs();\n      setActiveTab(availableTabs[0]);\n      \n      // ì–‘ë„ íƒ­ì—ì„œë§Œ íšŒì› ëª©ë¡ ë¡œë“œ\n      if (availableTabs.includes('transfer')) {\n        loadMembers();\n      }\n    }\n  }, [isOpen, loadMembers, getAvailableTabs]);\n\n  // ê²€ìƒ‰ í•„í„°ë§\n  useEffect(() => {\n    if (searchQuery.trim()) {\n      const query = searchQuery.toLowerCase().trim();\n      const filtered = members.filter(member =>\n        member.name.toLowerCase().includes(query) ||\n        member.phone.includes(query) ||\n        member.email.toLowerCase().includes(query)\n      );\n      setFilteredMembers(filtered);\n    } else {\n      setFilteredMembers(members);\n    }\n  }, [searchQuery, members]);\n\n  const handleMemberSelect = (member: Member) => {\n    setSelectedMember(member);\n  };\n\n  // ì–‘ë„ ì²˜ë¦¬\n  const handleTransfer = async () => {\n    if (!courseEnrollment || !selectedMember) {\n      toast.error('ì–‘ë„í•  ìˆ˜ê°•ê¶Œê³¼ ì–‘ë„ë°›ì„ íšŒì›ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');\n      return;\n    }\n\n    try {\n      setIsProcessing(true);\n\n      // 1. ê¸°ì¡´ ìˆ˜ê°• ì´ë ¥ ì¢…ë£Œ ì²˜ë¦¬\n      const updatedOriginalEnrollment: CourseEnrollment = {\n        ...courseEnrollment,\n        enrollmentStatus: 'cancelled',\n        completedSessions: 0,\n        notes: `${courseEnrollment.notes || ''}\\n[ì–‘ë„] ${new Date().toLocaleDateString()} ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„`.trim()\n      };\n\n      await dbManager.updateCourseEnrollment(courseEnrollment.id, updatedOriginalEnrollment);\n\n      // 2. ìƒˆë¡œìš´ ìˆ˜ê°• ì´ë ¥ ìƒì„±\n      const newEnrollment: Omit<CourseEnrollment, 'id' | 'createdAt' | 'updatedAt'> = {\n        memberId: selectedMember.id,\n        memberName: selectedMember.name,\n        productId: courseEnrollment.productId,\n        productName: courseEnrollment.productName,\n        productPrice: courseEnrollment.productPrice,\n        appliedPrice: courseEnrollment.appliedPrice,\n        programId: courseEnrollment.programId,\n        programName: courseEnrollment.programName,\n        programType: courseEnrollment.programType,\n        branchId: selectedMember.branchId,\n        branchName: selectedMember.branchName,\n        coach: selectedMember.coach,\n        coachName: selectedMember.coachName,\n        enrollmentStatus: 'active',\n        paidAmount: courseEnrollment.paidAmount,\n        unpaidAmount: courseEnrollment.unpaidAmount,\n        startDate: new Date(),\n        endDate: courseEnrollment.endDate,\n        sessionCount: courseEnrollment.sessionCount,\n        completedSessions: courseEnrollment.completedSessions || 0,\n        notes: `[ì–‘ë„ë°›ìŒ] ${new Date().toLocaleDateString()} ${courseEnrollment.memberName}ë‹˜ìœ¼ë¡œë¶€í„° ì–‘ë„ë°›ìŒ${memo ? `\\n${memo}` : ''}`\n      };\n\n      await dbManager.addCourseEnrollment(newEnrollment);\n      toast.success(`ìˆ˜ê°•ê¶Œì´ ì„±ê³µì ìœ¼ë¡œ ${selectedMember.name}ë‹˜ì—ê²Œ ì–‘ë„ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      \n      onSuccess();\n      handleClose();\n\n    } catch (error) {\n      console.error('ìˆ˜ê°•ê¶Œ ì–‘ë„ ì‹¤íŒ¨:', error);\n      toast.error('ìˆ˜ê°•ê¶Œ ì–‘ë„ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // í™€ë“œ ì‹œì‘\n  const handleStartHold = async () => {\n    if (!courseEnrollment) {\n      toast.error('ìˆ˜ê°•ê¶Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      setIsProcessing(true);\n      await dbManager.startHold(courseEnrollment.id, holdReason);\n      toast.success('í™€ë“œê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.');\n      \n      onSuccess();\n      handleClose();\n    } catch (error) {\n      console.error('í™€ë“œ ì‹œì‘ ì‹¤íŒ¨:', error);\n      toast.error(error instanceof Error ? error.message : 'í™€ë“œ ì‹œì‘ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // í™€ë“œ ì¢…ë£Œ\n  const handleEndHold = async () => {\n    if (!courseEnrollment) {\n      toast.error('ìˆ˜ê°•ê¶Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      setIsProcessing(true);\n      await dbManager.endHold(courseEnrollment.id);\n      toast.success('í™€ë“œê°€ ì¢…ë£Œë˜ê³  ìˆ˜ê°• ê¸°ê°„ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');\n      \n      onSuccess();\n      handleClose();\n    } catch (error) {\n      console.error('í™€ë“œ ì¢…ë£Œ ì‹¤íŒ¨:', error);\n      toast.error(error instanceof Error ? error.message : 'í™€ë“œ ì¢…ë£Œ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  // ê¸°ê°„ ì—°ì¥\n  const handleExtend = async () => {\n    if (!courseEnrollment) {\n      toast.error('ìˆ˜ê°•ê¶Œ ì •ë³´ë¥¼ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');\n      return;\n    }\n\n    if (extendDays <= 0) {\n      toast.error('ì—°ì¥ ê¸°ê°„ì€ 1ì¼ ì´ìƒì´ì–´ì•¼ í•©ë‹ˆë‹¤.');\n      return;\n    }\n\n    try {\n      setIsProcessing(true);\n      await dbManager.extendCourse(courseEnrollment.id, extendDays, extendReason);\n      toast.success(`ìˆ˜ê°• ê¸°ê°„ì´ ${extendDays}ì¼ ì—°ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.`);\n      \n      onSuccess();\n      handleClose();\n    } catch (error) {\n      console.error('ê¸°ê°„ ì—°ì¥ ì‹¤íŒ¨:', error);\n      toast.error(error instanceof Error ? error.message : 'ê¸°ê°„ ì—°ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');\n    } finally {\n      setIsProcessing(false);\n    }\n  };\n\n  const handleClose = () => {\n    setSearchQuery('');\n    setSelectedMember(null);\n    setMemo('');\n    setHoldReason('');\n    setExtendDays(30);\n    setExtendReason('');\n    onClose();\n  };\n\n  // ìˆ˜ê°•ê¶Œ ìƒíƒœ í…ìŠ¤íŠ¸\n  const getStatusText = (status: string): string => {\n    switch (status) {\n      case 'active': return 'ìˆ˜ê°•ì¤‘';\n      case 'hold': return 'í™€ë“œ';\n      case 'completed': return 'ì™„ë£Œ';\n      case 'cancelled': return 'ì·¨ì†Œ';\n      case 'unpaid': return 'ë¯¸ìˆ˜';\n      default: return status;\n    }\n  };\n\n  // í™€ë“œ ì •ë³´ í¬ë§·íŒ…\n  const formatHoldInfo = () => {\n    const holdInfo = courseEnrollment?.holdInfo;\n    if (!holdInfo?.isHold) return null;\n\n    const startDate = holdInfo.holdStartDate ? new Date(holdInfo.holdStartDate).toLocaleDateString() : '';\n    const days = holdInfo.totalHoldDays || 0;\n    \n    return `${startDate}ë¶€í„° í™€ë“œ ì‹œì‘ (ì´ ${days}ì¼)`;\n  };\n\n  // íšŒì› í…Œì´ë¸” ì»¬ëŸ¼ ì •ì˜\n  const memberColumns: TableColumn<Member>[] = [\n    {\n      key: 'name',\n      title: 'íšŒì›ëª…',\n      width: '120px'\n    },\n    {\n      key: 'phone',\n      title: 'ì—°ë½ì²˜',\n      width: '130px'\n    },\n    {\n      key: 'branchName',\n      title: 'ì§€ì ',\n      width: '100px'\n    },\n    {\n      key: 'coachName',\n      title: 'ë‹´ë‹¹ì½”ì¹˜',\n      width: '100px'\n    },\n    {\n      key: 'action',\n      title: 'ì„ íƒ',\n      width: '80px',\n      align: 'center' as const,\n      render: (value, record) => (\n        <Button\n          variant={selectedMember?.id === record.id ? 'primary' : 'secondary'}\n          onClick={() => handleMemberSelect(record)}\n          style={{ padding: '6px 12px', fontSize: '12px' }}\n        >\n          {selectedMember?.id === record.id ? 'ì„ íƒë¨' : 'ì„ íƒ'}\n        </Button>\n      )\n    }\n  ];\n\n  if (!courseEnrollment) return null;\n\n  const availableTabs = getAvailableTabs();\n\n  // ê¸°ë³¸ ì •ë³´ ì„¹ì…˜\n  const renderBasicInfo = () => (\n    <Section>\n      <SectionTitle>ìˆ˜ê°•ê¶Œ ì •ë³´</SectionTitle>\n      <InfoGrid>\n        <InfoItem>\n          <InfoLabel>íšŒì›ëª…</InfoLabel>\n          <InfoValue>{courseEnrollment.memberName}</InfoValue>\n        </InfoItem>\n        <InfoItem>\n          <InfoLabel>ìƒí’ˆëª…</InfoLabel>\n          <InfoValue>{courseEnrollment.productName}</InfoValue>\n        </InfoItem>\n        <InfoItem>\n          <InfoLabel>í”„ë¡œê·¸ë¨</InfoLabel>\n          <InfoValue>{courseEnrollment.programName} ({courseEnrollment.programType})</InfoValue>\n        </InfoItem>\n        <InfoItem>\n          <InfoLabel>ì§„í–‰ìƒí™©</InfoLabel>\n          <InfoValue>\n            {courseEnrollment.programType === 'íšŸìˆ˜ì œ' && courseEnrollment.sessionCount ? \n              `${courseEnrollment.completedSessions || 0}/${courseEnrollment.sessionCount}íšŒ ì™„ë£Œ` :\n              courseEnrollment.endDate ? \n                `${new Date(courseEnrollment.endDate).toLocaleDateString()}ê¹Œì§€` : \n                'ê¸°ê°„ì œ'\n            }\n          </InfoValue>\n        </InfoItem>\n        <InfoItem>\n          <InfoLabel>ì”ì—¬ ë¯¸ìˆ˜ê¸ˆ</InfoLabel>\n          <InfoValue style={{ color: courseEnrollment.unpaidAmount > 0 ? '#d32f2f' : AppColors.primary }}>\n            {courseEnrollment.unpaidAmount.toLocaleString()}ì›\n          </InfoValue>\n        </InfoItem>\n        <InfoItem>\n          <InfoLabel>ìˆ˜ê°• ìƒíƒœ</InfoLabel>\n          <InfoValue>\n            <StatusBadge $status={courseEnrollment.enrollmentStatus}>\n              {getStatusText(courseEnrollment.enrollmentStatus)}\n            </StatusBadge>\n            {courseEnrollment.holdInfo?.isHold && (\n              <div style={{ marginTop: '4px', fontSize: '12px', color: '#ef6c00' }}>\n                {formatHoldInfo()}\n              </div>\n            )}\n          </InfoValue>\n        </InfoItem>\n      </InfoGrid>\n    </Section>\n  );\n\n  // ì–‘ë„ íƒ­ ë‚´ìš©\n  const renderTransferContent = () => (\n    <>\n      <Section>\n        <SectionTitle>ì–‘ë„ë°›ì„ íšŒì› ì„ íƒ</SectionTitle>\n        <SearchContainer>\n          <TextField\n            value={searchQuery}\n            onChange={(e) => setSearchQuery(e.target.value)}\n            placeholder=\"íšŒì›ëª…, ì—°ë½ì²˜, ì´ë©”ì¼ë¡œ ê²€ìƒ‰...\"\n          />\n          \n          <MemberTableContainer>\n            <DataTable\n              columns={memberColumns}\n              data={filteredMembers}\n              loading={loading}\n              emptyText=\"ê²€ìƒ‰ëœ íšŒì›ì´ ì—†ìŠµë‹ˆë‹¤\"\n              emptyDescription=\"ë‹¤ë¥¸ ê²€ìƒ‰ì–´ë¡œ ì‹œë„í•´ë³´ì„¸ìš”\"\n              pagination={{\n                enabled: false\n              }}\n            />\n          </MemberTableContainer>\n        </SearchContainer>\n      </Section>\n\n      <Section>\n        <SectionTitle>ì–‘ë„ ê´€ë ¨ ë©”ëª¨</SectionTitle>\n        <TextField\n          value={memo}\n          onChange={(e) => setMemo(e.target.value)}\n          placeholder=\"ì–‘ë„ ê´€ë ¨ ë©”ëª¨ (ì„ íƒì‚¬í•­)\"\n          multiline\n        />\n      </Section>\n\n      <WarningText>\n        <strong>âš ï¸ ì–‘ë„ ì‹œ ì£¼ì˜ì‚¬í•­</strong><br />\n        â€¢ ì–‘ë„ í›„ì—ëŠ” ì·¨ì†Œí•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.<br />\n        â€¢ ê¸°ì¡´ íšŒì›ì˜ ìˆ˜ê°• ì´ë ¥ì€ 'ì·¨ì†Œ' ìƒíƒœë¡œ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n        â€¢ ì–‘ë„ë°›ëŠ” íšŒì›ì˜ ì§€ì ê³¼ ë‹´ë‹¹ ì½”ì¹˜ë¡œ ìë™ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n        â€¢ ì§„í–‰ëœ ìˆ˜ì—… íšŸìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.<br />\n        â€¢ ë¯¸ìˆ˜ê¸ˆì´ ìˆëŠ” ê²½ìš° ì–‘ë„ë°›ëŠ” íšŒì›ì´ ìŠ¹ê³„í•©ë‹ˆë‹¤.\n      </WarningText>\n    </>\n  );\n\n  // í™€ë“œ íƒ­ ë‚´ìš©\n  const renderHoldContent = () => {\n    const isCurrentlyHold = courseEnrollment.enrollmentStatus === 'hold';\n    \n    return (\n      <>\n        <Section>\n          <SectionTitle>{isCurrentlyHold ? 'í™€ë“œ ì¢…ë£Œ' : 'í™€ë“œ ì‹œì‘'}</SectionTitle>\n          \n          {isCurrentlyHold ? (\n            <WarningText>\n              <strong>ğŸ”„ í™€ë“œ ì¢…ë£Œ ì•ˆë‚´</strong><br />\n              â€¢ í™€ë“œë¥¼ ì¢…ë£Œí•˜ë©´ í™€ë“œ ê¸°ê°„ë§Œí¼ ìˆ˜ê°• ì¢…ë£Œì¼ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n              â€¢ í™€ë“œ ì‹œì‘ì¼: {courseEnrollment.holdInfo?.holdStartDate ? \n                new Date(courseEnrollment.holdInfo.holdStartDate).toLocaleDateString() : 'ì•Œ ìˆ˜ ì—†ìŒ'}<br />\n              â€¢ í™€ë“œ ì‚¬ìœ : {courseEnrollment.holdInfo?.holdReason || 'ì—†ìŒ'}\n            </WarningText>\n          ) : (\n            <>\n              <TextField\n                value={holdReason}\n                onChange={(e) => setHoldReason(e.target.value)}\n                placeholder=\"í™€ë“œ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)\"\n                multiline\n              />\n              \n              <WarningText>\n                <strong>â¸ï¸ í™€ë“œ ì‹œì‘ ì•ˆë‚´</strong><br />\n                â€¢ í™€ë“œ ì‹œì‘ ì‹œ ìˆ˜ê°• ìƒíƒœê°€ 'í™€ë“œ'ë¡œ ë³€ê²½ë©ë‹ˆë‹¤.<br />\n                â€¢ í™€ë“œ ì¢…ë£Œ ì‹œ í™€ë“œ ê¸°ê°„ë§Œí¼ ìˆ˜ê°• ì¢…ë£Œì¼ì´ ìë™ìœ¼ë¡œ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n                â€¢ í™€ë“œ ì¤‘ì—ëŠ” ìˆ˜ì—… ì°¸ì—¬ê°€ ë¶ˆê°€ëŠ¥í•©ë‹ˆë‹¤.\n              </WarningText>\n            </>\n          )}\n        </Section>\n      </>\n    );\n  };\n\n  // ì—°ì¥ íƒ­ ë‚´ìš©\n  const renderExtendContent = () => (\n    <>\n      <Section>\n        <SectionTitle>ìˆ˜ê°• ê¸°ê°„ ì—°ì¥</SectionTitle>\n        \n        <InputRow>\n          <SmallTextField\n            type=\"number\"\n            value={extendDays.toString()}\n            onChange={(e) => setExtendDays(parseInt(e.target.value) || 0)}\n            placeholder=\"ì—°ì¥ ì¼ìˆ˜\"\n          />\n          <span style={{ color: AppColors.onSurface, fontSize: '14px' }}>ì¼</span>\n        </InputRow>\n        \n        <TextField\n          value={extendReason}\n          onChange={(e) => setExtendReason(e.target.value)}\n          placeholder=\"ì—°ì¥ ì‚¬ìœ ë¥¼ ì…ë ¥í•˜ì„¸ìš” (ì„ íƒì‚¬í•­)\"\n          multiline\n        />\n        \n        {courseEnrollment.endDate && (\n          <div style={{ \n            padding: '12px', \n            background: '#e8f5e8', \n            borderRadius: '8px',\n            fontSize: '14px',\n            color: '#2e7d32'\n          }}>\n            <strong>ì—°ì¥ í›„ ì¢…ë£Œì¼ ì˜ˆìƒ:</strong> {' '}\n            {new Date(new Date(courseEnrollment.endDate).getTime() + extendDays * 24 * 60 * 60 * 1000)\n              .toLocaleDateString()}\n          </div>\n        )}\n        \n        <WarningText>\n          <strong>â° ì—°ì¥ ì•ˆë‚´</strong><br />\n          â€¢ í˜„ì¬ ì¢…ë£Œì¼ì—ì„œ ì…ë ¥ëœ ì¼ìˆ˜ë§Œí¼ ì—°ì¥ë©ë‹ˆë‹¤.<br />\n          â€¢ ì—°ì¥ ì´ë ¥ì€ ë¹„ê³ ë€ì— ìë™ìœ¼ë¡œ ê¸°ë¡ë©ë‹ˆë‹¤.<br />\n          â€¢ í™€ë“œ ì¤‘ì¸ ìˆ˜ê°•ê¶Œì€ ì—°ì¥í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.\n        </WarningText>\n      </Section>\n    </>\n  );\n\n  // í‘¸í„° ë²„íŠ¼\n  const renderFooterButtons = () => {\n    const cancelButton = (\n      <Button variant=\"secondary\" onClick={handleClose} disabled={isProcessing}>\n        ì·¨ì†Œ\n      </Button>\n    );\n\n    switch (activeTab) {\n      case 'transfer':\n        return (\n          <>\n            {cancelButton}\n            <Button \n              onClick={handleTransfer} \n              disabled={isProcessing || !selectedMember}\n            >\n              {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : 'ì–‘ë„ í™•ì¸'}\n            </Button>\n          </>\n        );\n      \n      case 'hold':\n        const isCurrentlyHold = courseEnrollment.enrollmentStatus === 'hold';\n        return (\n          <>\n            {cancelButton}\n            <Button \n              variant={isCurrentlyHold ? 'primary' : 'danger'}\n              onClick={isCurrentlyHold ? handleEndHold : handleStartHold}\n              disabled={isProcessing}\n            >\n              {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : isCurrentlyHold ? 'í™€ë“œ ì¢…ë£Œ' : 'í™€ë“œ ì‹œì‘'}\n            </Button>\n          </>\n        );\n      \n      case 'extend':\n        return (\n          <>\n            {cancelButton}\n            <Button \n              onClick={handleExtend} \n              disabled={isProcessing || extendDays <= 0 || courseEnrollment.enrollmentStatus === 'hold'}\n            >\n              {isProcessing ? 'ì²˜ë¦¬ ì¤‘...' : `${extendDays}ì¼ ì—°ì¥`}\n            </Button>\n          </>\n        );\n      \n      default:\n        return cancelButton;\n    }\n  };\n\n  return (\n    <Modal\n      isOpen={isOpen}\n      onClose={handleClose}\n      width=\"min(95vw, 800px)\"\n      header=\"ìˆ˜ê°•ê¶Œ ê´€ë¦¬\"\n      body={\n        <ModalContent>\n          {/* ê¸°ë³¸ ì •ë³´ (í•­ìƒ í‘œì‹œ) */}\n          {renderBasicInfo()}\n\n          {/* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */}\n          <TabContainer>\n            {availableTabs.map(tab => (\n              <Tab\n                key={tab}\n                $active={activeTab === tab}\n                onClick={() => setActiveTab(tab)}\n                disabled={isProcessing}\n              >\n                {getTabLabel(tab)}\n              </Tab>\n            ))}\n          </TabContainer>\n\n          {/* íƒ­ ë‚´ìš© */}\n          {activeTab === 'transfer' && renderTransferContent()}\n          {activeTab === 'hold' && renderHoldContent()}\n          {activeTab === 'extend' && renderExtendContent()}\n        </ModalContent>\n      }\n      footer={\n        <div style={{ display: 'flex', justifyContent: 'flex-end', gap: '12px', width: '100%' }}>\n          {renderFooterButtons()}\n        </div>\n      }\n    />\n  );\n};\n\nexport default CourseManagementModal;"
        }
    ]
}