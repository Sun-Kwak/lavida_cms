{
    "sourceFile": "src/pages/CMS/Member/MemberExercisePrescriptionHistory.tsx",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 3,
            "patches": [
                {
                    "date": 1762427972927,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1762428143724,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,9 +1,8 @@\n import React, { useState, useEffect, useCallback } from 'react';\n import { toast } from 'react-toastify';\n import styled from 'styled-components';\n import { AppColors } from '../../../styles/colors';\n-import { AppTextStyles } from '../../../styles/textStyles';\n import { dbManager, ExercisePrescription } from '../../../utils/indexedDB';\n import { SearchArea, type PeriodOption } from '../../../components/SearchArea';\n import DataTable, { type TableColumn } from '../../../components/DataTable';\n \n@@ -11,54 +10,8 @@\n const PageContainer = styled.div`\n   width: 100%;\n `;\n \n-const StatsSection = styled.div`\n-  display: grid;\n-  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n-  gap: 16px;\n-  margin-bottom: 24px;\n-`;\n-\n-const StatCard = styled.div<{ $isActive?: boolean; $isClickable?: boolean }>`\n-  background: ${props => props.$isActive ? '#f0f7ff' : 'white'};\n-  border: 1px solid ${props => props.$isActive ? AppColors.primary : AppColors.borderLight};\n-  border-radius: 12px;\n-  padding: 20px;\n-  text-align: center;\n-  cursor: ${props => props.$isClickable ? 'pointer' : 'default'};\n-  transition: all 0.2s ease;\n-  \n-  ${props => props.$isClickable && `\n-    &:hover {\n-      background: #f0f7ff;\n-      border-color: ${AppColors.primary};\n-      transform: translateY(-2px);\n-      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);\n-    }\n-  `}\n-\n-  ${props => props.$isActive && `\n-    background: #f0f7ff;\n-    border-color: ${AppColors.primary};\n-    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);\n-  `}\n-`;\n-\n-const StatLabel = styled.div`\n-  font-size: ${AppTextStyles.body3.fontSize};\n-  color: ${AppColors.onSurface};\n-  margin-bottom: 8px;\n-  font-weight: 500;\n-`;\n-\n-const StatValue = styled.div<{ color?: string }>`\n-  font-size: 24px;\n-  font-weight: 700;\n-  color: ${props => props.color || AppColors.onBackground};\n-  line-height: 1.2;\n-`;\n-\n const VersionBadge = styled.span<{ $isLatest?: boolean }>`\n   display: inline-flex;\n   align-items: center;\n   gap: 4px;\n@@ -101,17 +54,8 @@\n   // 기간 선택 관련 상태\n   const [selectedPeriod, setSelectedPeriod] = useState<PeriodOption>('1month');\n   const [customStartDate, setCustomStartDate] = useState<string>('');\n   const [customEndDate, setCustomEndDate] = useState<string>('');\n-  \n-  // 추가 필터 상태\n-  const [selectedStatCard, setSelectedStatCard] = useState<'all' | 'latest' | 'history'>('all');\n-  \n-  const [stats, setStats] = useState<MemberStats>({\n-    totalVersions: 0,\n-    latestDate: '-',\n-    firstDate: '-'\n-  });\n \n   // 기간별 검색 범위 계산\n   const getDateRange = useCallback(() => {\n     const today = new Date();\n@@ -142,27 +86,9 @@\n   }, [selectedPeriod, customStartDate, customEndDate]);\n \n   // 통계 계산\n   const calculateStats = useCallback((prescriptionsList: ExercisePrescription[]) => {\n-    const totalVersions = prescriptionsList.length;\n-    \n-    let latestDate = '-';\n-    let firstDate = '-';\n-    \n-    if (prescriptionsList.length > 0) {\n-      const sortedByDate = prescriptionsList.sort((a, b) => \n-        new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n-      );\n-      \n-      latestDate = new Date(sortedByDate[0].updatedAt).toLocaleDateString('ko-KR');\n-      firstDate = new Date(sortedByDate[sortedByDate.length - 1].updatedAt).toLocaleDateString('ko-KR');\n-    }\n-\n-    setStats({\n-      totalVersions,\n-      latestDate,\n-      firstDate\n-    });\n+    // 통계 카드가 제거되어 더 이상 필요하지 않음\n   }, []);\n \n   const loadPrescriptionHistory = useCallback(async (period?: PeriodOption, startDate?: string, endDate?: string) => {\n     try {\n@@ -252,29 +178,17 @@\n         prescription.painHistory.toLowerCase().includes(query)\n       );\n     }\n \n-    // 상태별 필터링\n-    if (selectedStatCard === 'latest') {\n-      filtered = filtered.filter(prescription => prescription.isLatest);\n-    } else if (selectedStatCard === 'history') {\n-      filtered = filtered.filter(prescription => !prescription.isLatest);\n-    }\n-\n     setFilteredPrescriptions(filtered);\n-  }, [prescriptions, searchQuery, selectedStatCard]);\n+  }, [prescriptions, searchQuery]);\n \n   // 날짜 범위 표시\n   const getDateRangeDisplay = useCallback(() => {\n     const range = getDateRange();\n     return `${range.start.toLocaleDateString('ko-KR')} ~ ${range.end.toLocaleDateString('ko-KR')}`;\n   }, [getDateRange]);\n \n-  // 통계 카드 클릭 핸들러\n-  const handleStatCardClick = (cardType: 'all' | 'latest' | 'history') => {\n-    setSelectedStatCard(cardType);\n-  };\n-\n   // 검색 핸들러\n   const handleSearch = async () => {\n     await loadPrescriptionHistory(selectedPeriod, customStartDate, customEndDate);\n   };\n@@ -393,9 +307,9 @@\n   }\n \n   return (\n     <PageContainer>\n-      {/* 새로운 SearchArea 컴포넌트 사용 */}\n+      {/* SearchArea 컴포넌트 사용 */}\n       <SearchArea\n         selectedPeriod={selectedPeriod}\n         onPeriodChange={setSelectedPeriod}\n         customStartDate={customStartDate}\n@@ -409,59 +323,10 @@\n         searchPlaceholder=\"회원명, 회원ID, 복용약물, 이력으로 검색...\"\n         autoSearchOnDateChange={false}\n       />\n \n-      <StatsSection>\n-        <StatCard \n-          $isActive={selectedStatCard === 'all'} \n-          $isClickable={true}\n-          onClick={() => handleStatCardClick('all')}\n-        >\n-          <StatLabel>전체 버전</StatLabel>\n-          <StatValue>{stats.totalVersions.toLocaleString()}개</StatValue>\n-        </StatCard>\n-        <StatCard \n-          $isActive={selectedStatCard === 'latest'} \n-          $isClickable={true}\n-          onClick={() => handleStatCardClick('latest')}\n-        >\n-          <StatLabel>최신 버전</StatLabel>\n-          <StatValue color=\"#28a745\">\n-            {filteredPrescriptions.filter(p => p.isLatest).length.toLocaleString()}개\n-          </StatValue>\n-        </StatCard>\n-        <StatCard \n-          $isActive={selectedStatCard === 'history'} \n-          $isClickable={true}\n-          onClick={() => handleStatCardClick('history')}\n-        >\n-          <StatLabel>이전 버전</StatLabel>\n-          <StatValue color=\"#ffc107\">\n-            {filteredPrescriptions.filter(p => !p.isLatest).length.toLocaleString()}개\n-          </StatValue>\n-        </StatCard>\n-        <StatCard $isActive={false} $isClickable={false}>\n-          <StatLabel>최신 작성일</StatLabel>\n-          <StatValue color=\"#007bff\">{stats.latestDate}</StatValue>\n-        </StatCard>\n-      </StatsSection>\n-\n       <DataTable\n-        title={\n-          <div>\n-            운동처방 히스토리\n-            {selectedStatCard !== 'all' && (\n-              <span style={{ \n-                fontSize: '14px', \n-                fontWeight: 'normal', \n-                color: AppColors.primary,\n-                marginLeft: '8px'\n-              }}>\n-                ({selectedStatCard === 'latest' ? '최신 버전만' : '이전 버전만'})\n-              </span>\n-            )}\n-          </div>\n-        }\n+        title=\"운동처방 히스토리\"\n         columns={columns}\n         data={filteredPrescriptions}\n         loading={loading}\n       />\n"
                },
                {
                    "date": 1762429025810,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,5 +1,6 @@\n import React, { useState, useEffect, useCallback } from 'react';\n+import { useNavigate } from 'react-router-dom';\n import { toast } from 'react-toastify';\n import styled from 'styled-components';\n import { AppColors } from '../../../styles/colors';\n import { dbManager, ExercisePrescription } from '../../../utils/indexedDB';\n@@ -38,15 +39,11 @@\n     color: white;\n   }\n `;\n \n-interface MemberStats {\n-  totalVersions: number;\n-  latestDate: string;\n-  firstDate: string;\n-}\n-\n const MemberExercisePrescriptionHistory: React.FC = () => {\n+  const navigate = useNavigate();\n+  \n   const [prescriptions, setPrescriptions] = useState<ExercisePrescription[]>([]);\n   const [filteredPrescriptions, setFilteredPrescriptions] = useState<ExercisePrescription[]>([]);\n   const [loading, setLoading] = useState(false);\n   const [searchQuery, setSearchQuery] = useState<string>('');\n@@ -206,10 +203,10 @@\n   };\n \n   // 운동처방서 상세 보기\n   const handleViewPrescription = (prescription: ExercisePrescription) => {\n-    // 운동처방서 페이지로 이동 (읽기 전용 모드)\n-    window.open(`/exercise-prescription?memberId=${prescription.memberId}&prescriptionId=${prescription.id}`, '_blank');\n+    // 운동처방서 상세보기 페이지로 이동\n+    navigate(`/cms/member/exercise-prescription/${prescription.id}`);\n   };\n \n   // 테이블 컬럼 정의\n   const columns: TableColumn<ExercisePrescription>[] = [\n"
                },
                {
                    "date": 1762429155120,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -1,12 +1,13 @@\n import React, { useState, useEffect, useCallback } from 'react';\n-import { useNavigate } from 'react-router-dom';\n import { toast } from 'react-toastify';\n import styled from 'styled-components';\n import { AppColors } from '../../../styles/colors';\n import { dbManager, ExercisePrescription } from '../../../utils/indexedDB';\n import { SearchArea, type PeriodOption } from '../../../components/SearchArea';\n import DataTable, { type TableColumn } from '../../../components/DataTable';\n+import ExercisePrescriptionModal from '../../../components/ExercisePrescriptionModal';\n+import ExercisePrescriptionForm from '../../../components/ExercisePrescriptionForm';\n \n // 스타일 컴포넌트들\n const PageContainer = styled.div`\n   width: 100%;\n@@ -40,15 +41,17 @@\n   }\n `;\n \n const MemberExercisePrescriptionHistory: React.FC = () => {\n-  const navigate = useNavigate();\n-  \n   const [prescriptions, setPrescriptions] = useState<ExercisePrescription[]>([]);\n   const [filteredPrescriptions, setFilteredPrescriptions] = useState<ExercisePrescription[]>([]);\n   const [loading, setLoading] = useState(false);\n   const [searchQuery, setSearchQuery] = useState<string>('');\n   \n+  // 모달 관련 상태\n+  const [isModalOpen, setIsModalOpen] = useState(false);\n+  const [selectedPrescription, setSelectedPrescription] = useState<ExercisePrescription | null>(null);\n+  \n   // 기간 선택 관련 상태\n   const [selectedPeriod, setSelectedPeriod] = useState<PeriodOption>('1month');\n   const [customStartDate, setCustomStartDate] = useState<string>('');\n   const [customEndDate, setCustomEndDate] = useState<string>('');\n@@ -203,12 +206,18 @@\n   };\n \n   // 운동처방서 상세 보기\n   const handleViewPrescription = (prescription: ExercisePrescription) => {\n-    // 운동처방서 상세보기 페이지로 이동\n-    navigate(`/cms/member/exercise-prescription/${prescription.id}`);\n+    // 모달로 운동처방서 상세보기\n+    setSelectedPrescription(prescription);\n+    setIsModalOpen(true);\n   };\n \n+  const handleCloseModal = () => {\n+    setIsModalOpen(false);\n+    setSelectedPrescription(null);\n+  };\n+\n   // 테이블 컬럼 정의\n   const columns: TableColumn<ExercisePrescription>[] = [\n     {\n       key: 'createdAt',\n@@ -326,8 +335,62 @@\n         columns={columns}\n         data={filteredPrescriptions}\n         loading={loading}\n       />\n+\n+      {/* 운동처방 상세보기 모달 */}\n+      <ExercisePrescriptionModal\n+        isOpen={isModalOpen}\n+        onClose={handleCloseModal}\n+        version={selectedPrescription?.version}\n+      >\n+        {selectedPrescription && (\n+          <ExercisePrescriptionForm\n+            selectedMember={{\n+              id: selectedPrescription.memberId,\n+              name: selectedPrescription.memberName,\n+              phone: '',\n+              email: '',\n+              birth: '',\n+              gender: 'male',\n+              address: '',\n+              sigunguCode: '',\n+              dong: '',\n+              roadAddress: '',\n+              jibunAddress: '',\n+              branchId: '',\n+              branchName: '',\n+              coach: '',\n+              coachName: '',\n+              joinPath: '',\n+              loginId: '',\n+              loginPassword: null,\n+              enableLogin: false,\n+              agreementInfo: {\n+                agreements: [],\n+                customerSignature: '',\n+                staffSignature: ''\n+              },\n+              isActive: true,\n+              registrationDate: '',\n+              createdAt: new Date(),\n+              updatedAt: new Date()\n+            }}\n+            prescription={selectedPrescription}\n+            formData={{\n+              height: selectedPrescription.height,\n+              weight: selectedPrescription.weight,\n+              footSize: selectedPrescription.footSize,\n+              medications: selectedPrescription.medications,\n+              medicalHistory: selectedPrescription.medicalHistory,\n+              painHistory: selectedPrescription.painHistory,\n+              bodyImages: selectedPrescription.bodyImages,\n+              signatureData: selectedPrescription.signatureData\n+            }}\n+            readOnly={true}\n+          />\n+        )}\n+      </ExercisePrescriptionModal>\n     </PageContainer>\n   );\n };\n \n"
                }
            ],
            "date": 1762427972927,
            "name": "Commit-0",
            "content": "import React, { useState, useEffect, useCallback } from 'react';\nimport { toast } from 'react-toastify';\nimport styled from 'styled-components';\nimport { AppColors } from '../../../styles/colors';\nimport { AppTextStyles } from '../../../styles/textStyles';\nimport { dbManager, ExercisePrescription } from '../../../utils/indexedDB';\nimport { SearchArea, type PeriodOption } from '../../../components/SearchArea';\nimport DataTable, { type TableColumn } from '../../../components/DataTable';\n\n// 스타일 컴포넌트들\nconst PageContainer = styled.div`\n  width: 100%;\n`;\n\nconst StatsSection = styled.div`\n  display: grid;\n  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));\n  gap: 16px;\n  margin-bottom: 24px;\n`;\n\nconst StatCard = styled.div<{ $isActive?: boolean; $isClickable?: boolean }>`\n  background: ${props => props.$isActive ? '#f0f7ff' : 'white'};\n  border: 1px solid ${props => props.$isActive ? AppColors.primary : AppColors.borderLight};\n  border-radius: 12px;\n  padding: 20px;\n  text-align: center;\n  cursor: ${props => props.$isClickable ? 'pointer' : 'default'};\n  transition: all 0.2s ease;\n  \n  ${props => props.$isClickable && `\n    &:hover {\n      background: #f0f7ff;\n      border-color: ${AppColors.primary};\n      transform: translateY(-2px);\n      box-shadow: 0 4px 12px rgba(0, 123, 255, 0.15);\n    }\n  `}\n\n  ${props => props.$isActive && `\n    background: #f0f7ff;\n    border-color: ${AppColors.primary};\n    box-shadow: 0 2px 8px rgba(0, 123, 255, 0.1);\n  `}\n`;\n\nconst StatLabel = styled.div`\n  font-size: ${AppTextStyles.body3.fontSize};\n  color: ${AppColors.onSurface};\n  margin-bottom: 8px;\n  font-weight: 500;\n`;\n\nconst StatValue = styled.div<{ color?: string }>`\n  font-size: 24px;\n  font-weight: 700;\n  color: ${props => props.color || AppColors.onBackground};\n  line-height: 1.2;\n`;\n\nconst VersionBadge = styled.span<{ $isLatest?: boolean }>`\n  display: inline-flex;\n  align-items: center;\n  gap: 4px;\n  padding: 4px 8px;\n  border-radius: 4px;\n  font-size: 11px;\n  font-weight: 600;\n  background: ${props => props.$isLatest ? AppColors.success : AppColors.borderLight};\n  color: ${props => props.$isLatest ? 'white' : AppColors.onInput1};\n`;\n\nconst ActionButton = styled.button`\n  background: none;\n  border: 1px solid ${AppColors.primary};\n  color: ${AppColors.primary};\n  border-radius: 4px;\n  padding: 6px 12px;\n  font-size: 12px;\n  cursor: pointer;\n  transition: all 0.2s ease;\n\n  &:hover {\n    background: ${AppColors.primary};\n    color: white;\n  }\n`;\n\ninterface MemberStats {\n  totalVersions: number;\n  latestDate: string;\n  firstDate: string;\n}\n\nconst MemberExercisePrescriptionHistory: React.FC = () => {\n  const [prescriptions, setPrescriptions] = useState<ExercisePrescription[]>([]);\n  const [filteredPrescriptions, setFilteredPrescriptions] = useState<ExercisePrescription[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [searchQuery, setSearchQuery] = useState<string>('');\n  \n  // 기간 선택 관련 상태\n  const [selectedPeriod, setSelectedPeriod] = useState<PeriodOption>('1month');\n  const [customStartDate, setCustomStartDate] = useState<string>('');\n  const [customEndDate, setCustomEndDate] = useState<string>('');\n  \n  // 추가 필터 상태\n  const [selectedStatCard, setSelectedStatCard] = useState<'all' | 'latest' | 'history'>('all');\n  \n  const [stats, setStats] = useState<MemberStats>({\n    totalVersions: 0,\n    latestDate: '-',\n    firstDate: '-'\n  });\n\n  // 기간별 검색 범위 계산\n  const getDateRange = useCallback(() => {\n    const today = new Date();\n    const startDate = new Date();\n    \n    switch (selectedPeriod) {\n      case '1month':\n        startDate.setMonth(today.getMonth() - 1);\n        return { start: startDate, end: today };\n      case '3month':\n        startDate.setMonth(today.getMonth() - 3);\n        return { start: startDate, end: today };\n      case '6month':\n        startDate.setMonth(today.getMonth() - 6);\n        return { start: startDate, end: today };\n      case 'custom':\n        if (customStartDate && customEndDate) {\n          return {\n            start: new Date(customStartDate + 'T00:00:00'),\n            end: new Date(customEndDate + 'T23:59:59')\n          };\n        }\n        return { start: new Date(0), end: today };\n      default:\n        startDate.setMonth(today.getMonth() - 1);\n        return { start: startDate, end: today };\n    }\n  }, [selectedPeriod, customStartDate, customEndDate]);\n\n  // 통계 계산\n  const calculateStats = useCallback((prescriptionsList: ExercisePrescription[]) => {\n    const totalVersions = prescriptionsList.length;\n    \n    let latestDate = '-';\n    let firstDate = '-';\n    \n    if (prescriptionsList.length > 0) {\n      const sortedByDate = prescriptionsList.sort((a, b) => \n        new Date(b.updatedAt).getTime() - new Date(a.updatedAt).getTime()\n      );\n      \n      latestDate = new Date(sortedByDate[0].updatedAt).toLocaleDateString('ko-KR');\n      firstDate = new Date(sortedByDate[sortedByDate.length - 1].updatedAt).toLocaleDateString('ko-KR');\n    }\n\n    setStats({\n      totalVersions,\n      latestDate,\n      firstDate\n    });\n  }, []);\n\n  const loadPrescriptionHistory = useCallback(async (period?: PeriodOption, startDate?: string, endDate?: string) => {\n    try {\n      setLoading(true);\n      console.log('운동처방 히스토리 데이터 로딩 시작...');\n      \n      // 모든 운동처방서 조회\n      const allPrescriptions = await dbManager.exercisePrescription.getAllExercisePrescriptions();\n      console.log('전체 운동처방서 수:', allPrescriptions.length);\n      \n      // 기간별 필터링 (생성일 기준) - 매개변수가 있으면 사용, 없으면 현재 상태 사용\n      const currentPeriod = period ?? selectedPeriod;\n      const currentStartDate = startDate ?? customStartDate;\n      const currentEndDate = endDate ?? customEndDate;\n      \n      let dateRange: { start: Date; end: Date };\n      \n      if (currentPeriod === 'custom' && currentStartDate && currentEndDate) {\n        dateRange = {\n          start: new Date(currentStartDate + 'T00:00:00'),\n          end: new Date(currentEndDate + 'T23:59:59')\n        };\n      } else {\n        const today = new Date();\n        const rangeStartDate = new Date();\n        \n        switch (currentPeriod) {\n          case '3month':\n            rangeStartDate.setMonth(today.getMonth() - 3);\n            dateRange = { start: rangeStartDate, end: today };\n            break;\n          case '6month':\n            rangeStartDate.setMonth(today.getMonth() - 6);\n            dateRange = { start: rangeStartDate, end: today };\n            break;\n          default:\n            rangeStartDate.setMonth(today.getMonth() - 1);\n            dateRange = { start: rangeStartDate, end: today };\n        }\n      }\n      \n      const filteredByDate = allPrescriptions.filter(prescription => {\n        const prescriptionDate = new Date(prescription.createdAt);\n        return prescriptionDate >= dateRange.start && prescriptionDate <= dateRange.end;\n      });\n      \n      // 최신 순으로 정렬\n      const sortedPrescriptions = filteredByDate.sort((a, b) => \n        new Date(b.createdAt).getTime() - new Date(a.createdAt).getTime()\n      );\n      \n      console.log(`${currentPeriod} 기간 내 운동처방 히스토리:`, sortedPrescriptions.length);\n      \n      setPrescriptions(sortedPrescriptions);\n      calculateStats(sortedPrescriptions);\n    } catch (error) {\n      console.error('운동처방 히스토리 로드 실패:', error);\n      toast.error('운동처방 히스토리를 불러오는데 실패했습니다.');\n    } finally {\n      setLoading(false);\n    }\n  }, [selectedPeriod, customStartDate, customEndDate, calculateStats]);\n\n  // 컴포넌트 마운트 시 데이터 로드\n  useEffect(() => {\n    loadPrescriptionHistory();\n  }, [loadPrescriptionHistory]);\n\n  // 기간 변경 시 자동 검색\n  useEffect(() => {\n    if (selectedPeriod !== 'custom') {\n      loadPrescriptionHistory(selectedPeriod);\n    }\n  }, [selectedPeriod, loadPrescriptionHistory]);\n\n  // 검색 및 필터링\n  useEffect(() => {\n    let filtered = prescriptions;\n\n    // 검색어 필터링\n    if (searchQuery.trim()) {\n      const query = searchQuery.toLowerCase();\n      filtered = filtered.filter(prescription => \n        prescription.memberName.toLowerCase().includes(query) ||\n        prescription.memberId.toLowerCase().includes(query) ||\n        prescription.medications.toLowerCase().includes(query) ||\n        prescription.painHistory.toLowerCase().includes(query)\n      );\n    }\n\n    // 상태별 필터링\n    if (selectedStatCard === 'latest') {\n      filtered = filtered.filter(prescription => prescription.isLatest);\n    } else if (selectedStatCard === 'history') {\n      filtered = filtered.filter(prescription => !prescription.isLatest);\n    }\n\n    setFilteredPrescriptions(filtered);\n  }, [prescriptions, searchQuery, selectedStatCard]);\n\n  // 날짜 범위 표시\n  const getDateRangeDisplay = useCallback(() => {\n    const range = getDateRange();\n    return `${range.start.toLocaleDateString('ko-KR')} ~ ${range.end.toLocaleDateString('ko-KR')}`;\n  }, [getDateRange]);\n\n  // 통계 카드 클릭 핸들러\n  const handleStatCardClick = (cardType: 'all' | 'latest' | 'history') => {\n    setSelectedStatCard(cardType);\n  };\n\n  // 검색 핸들러\n  const handleSearch = async () => {\n    await loadPrescriptionHistory(selectedPeriod, customStartDate, customEndDate);\n  };\n\n  // 날짜 포맷 함수\n  const formatDate = (date: Date | string) => {\n    const d = new Date(date);\n    return d.toLocaleDateString('ko-KR', {\n      year: 'numeric',\n      month: '2-digit',\n      day: '2-digit',\n      hour: '2-digit',\n      minute: '2-digit'\n    });\n  };\n\n  // 운동처방서 상세 보기\n  const handleViewPrescription = (prescription: ExercisePrescription) => {\n    // 운동처방서 페이지로 이동 (읽기 전용 모드)\n    window.open(`/exercise-prescription?memberId=${prescription.memberId}&prescriptionId=${prescription.id}`, '_blank');\n  };\n\n  // 테이블 컬럼 정의\n  const columns: TableColumn<ExercisePrescription>[] = [\n    {\n      key: 'createdAt',\n      title: '작성일시',\n      width: '150px',\n      render: (value, record) => formatDate(record.createdAt)\n    },\n    {\n      key: 'memberName',\n      title: '회원명',\n      width: '120px'\n    },\n    {\n      key: 'memberId',\n      title: '회원ID',\n      width: '100px'\n    },\n    {\n      key: 'version',\n      title: '버전',\n      width: '80px',\n      align: 'center' as const,\n      render: (value, record) => (\n        <VersionBadge $isLatest={record.isLatest}>\n          v{record.version || 1}\n          {record.isLatest && ' 최신'}\n        </VersionBadge>\n      )\n    },\n    {\n      key: 'height',\n      title: '키/체중',\n      width: '100px',\n      render: (value, record) => (\n        record.height && record.weight \n          ? `${record.height}cm / ${record.weight}kg`\n          : '-'\n      )\n    },\n    {\n      key: 'medications',\n      title: '복용약물',\n      width: '150px',\n      render: (value, record) => (\n        record.medications ? (\n          <span title={record.medications}>\n            {record.medications.length > 20 \n              ? record.medications.substring(0, 20) + '...' \n              : record.medications\n            }\n          </span>\n        ) : '-'\n      )\n    },\n    {\n      key: 'prescriptionDate',\n      title: '처방일',\n      width: '120px',\n      render: (value, record) => formatDate(record.prescriptionDate)\n    },\n    {\n      key: 'signedAt',\n      title: '서명일',\n      width: '120px',\n      render: (value, record) => (\n        record.signedAt ? formatDate(record.signedAt) : '-'\n      )\n    },\n    {\n      key: 'actions',\n      title: '작업',\n      width: '100px',\n      align: 'center' as const,\n      render: (value, record) => (\n        <ActionButton onClick={() => handleViewPrescription(record)}>\n          상세보기\n        </ActionButton>\n      )\n    }\n  ];\n\n  if (loading) {\n    return (\n      <PageContainer>\n        <DataTable\n          title=\"운동처방 히스토리\"\n          columns={columns}\n          data={[]}\n          loading={true}\n        />\n      </PageContainer>\n    );\n  }\n\n  return (\n    <PageContainer>\n      {/* 새로운 SearchArea 컴포넌트 사용 */}\n      <SearchArea\n        selectedPeriod={selectedPeriod}\n        onPeriodChange={setSelectedPeriod}\n        customStartDate={customStartDate}\n        customEndDate={customEndDate}\n        onCustomStartDateChange={setCustomStartDate}\n        onCustomEndDateChange={setCustomEndDate}\n        dateRangeDisplay={getDateRangeDisplay()}\n        searchValue={searchQuery}\n        onSearchChange={setSearchQuery}\n        onSearch={handleSearch}\n        searchPlaceholder=\"회원명, 회원ID, 복용약물, 이력으로 검색...\"\n        autoSearchOnDateChange={false}\n      />\n\n      <StatsSection>\n        <StatCard \n          $isActive={selectedStatCard === 'all'} \n          $isClickable={true}\n          onClick={() => handleStatCardClick('all')}\n        >\n          <StatLabel>전체 버전</StatLabel>\n          <StatValue>{stats.totalVersions.toLocaleString()}개</StatValue>\n        </StatCard>\n        <StatCard \n          $isActive={selectedStatCard === 'latest'} \n          $isClickable={true}\n          onClick={() => handleStatCardClick('latest')}\n        >\n          <StatLabel>최신 버전</StatLabel>\n          <StatValue color=\"#28a745\">\n            {filteredPrescriptions.filter(p => p.isLatest).length.toLocaleString()}개\n          </StatValue>\n        </StatCard>\n        <StatCard \n          $isActive={selectedStatCard === 'history'} \n          $isClickable={true}\n          onClick={() => handleStatCardClick('history')}\n        >\n          <StatLabel>이전 버전</StatLabel>\n          <StatValue color=\"#ffc107\">\n            {filteredPrescriptions.filter(p => !p.isLatest).length.toLocaleString()}개\n          </StatValue>\n        </StatCard>\n        <StatCard $isActive={false} $isClickable={false}>\n          <StatLabel>최신 작성일</StatLabel>\n          <StatValue color=\"#007bff\">{stats.latestDate}</StatValue>\n        </StatCard>\n      </StatsSection>\n\n      <DataTable\n        title={\n          <div>\n            운동처방 히스토리\n            {selectedStatCard !== 'all' && (\n              <span style={{ \n                fontSize: '14px', \n                fontWeight: 'normal', \n                color: AppColors.primary,\n                marginLeft: '8px'\n              }}>\n                ({selectedStatCard === 'latest' ? '최신 버전만' : '이전 버전만'})\n              </span>\n            )}\n          </div>\n        }\n        columns={columns}\n        data={filteredPrescriptions}\n        loading={loading}\n      />\n    </PageContainer>\n  );\n};\n\nexport default MemberExercisePrescriptionHistory;"
        }
    ]
}